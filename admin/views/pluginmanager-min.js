/*! Fabrik */
define(["jquery","fab/fabrik"],function(e,r){return new Class({pluginTotal:0,topTotal:-1,initialize:function(n,t,e){"string"===typeOf(n)&&(n=[n]),this.id=t,this.plugins=n,this.type=e,window.addEvent("domready",function(){var t;for(this.accordion=new Fx.Accordion([],[],{alwaysHide:!0,display:-1,duration:"short"}),t=0;t<n.length;t++)this.addTop(n[t]);this.periodical=this.iniAccordion.periodical(250,this),this.watchPluginSelect(),this.watchDelete(),this.watchAdd();var e=document.id("plugins");"null"!==typeOf(e)&&(e.addEvent("click:relay(h3.title)",function(t,e){document.id("plugins").getElements("h3.title").each(function(t){t!==e&&t.removeClass("pane-toggler-down")}),e.toggleClass("pane-toggler-down")}),this.watchDescriptions(e))}.bind(this))},watchDescriptions:function(t){t.addEvent("keyup:relay(input[name*=plugin_description])",function(t,e){var n=e.getParent(".actionContainer"),i=n.getElement(".pluginTitle"),n=n.getElement("select[name*=plugin]").getValue(),e=e.getValue();i.set("text",n+": "+e)})},iniAccordion:function(){this.pluginTotal===this.plugins.length&&(1===this.plugins.length?this.accordion.display(0):this.accordion.display(-1),clearInterval(this.periodical))},canSaveForm:function(){return"complete"===document.readyState&&r.requestQueue.empty()},watchDelete:function(){document.id("adminForm").addEvent("click:relay(a.removeButton, a[data-button=removeButton])",function(t,e){t.preventDefault(),this.pluginTotal--,this.topTotal--,this.deletePlugin(t)}.bind(this))},watchAdd:function(){var t=document.id("addPlugin");"null"!==typeOf(t)&&t.addEvent("click",function(t){t.stop(),this.accordion.display(-1),this.addTop()}.bind(this))},addTop:function(e){"string"===typeOf(e)?(o=!(a=t=!(s=1)),e=e||"",i=n=""):(s=e?e.published:1,t=e?e.show_icon:1,a=e?e.must_validate:0,o=e?e.validate_hidden:1,n=e?e.validate_in:"both",i=e?e.validation_on:"both",e=e?e.plugin:"");var t,n,i,a,o,l=new Element("div.actionContainer.panel.accordion-group"),d=new Element("a.accordion-toggle",{href:"#"}),c=(d.adopt(new Element("span.pluginTitle").set("text",""!==e?e+" "+Joomla.JText._("COM_FABRIK_LOADING").toLowerCase():Joomla.JText._("COM_FABRIK_LOADING"))),new Element("div.title.pane-toggler.accordion-heading").adopt(new Element("strong").adopt(d))),d=new Element("div.accordion-body"),u=(l.adopt(c),l.adopt(d),l.inject(document.id("plugins")),this.accordion.addSection(c,d),this.topTotal+1),l={option:"com_fabrik",view:"plugin",task:"top",format:"raw",type:this.type,plugin:e,plugin_published:s,show_icon:t,must_validate:a,validate_hidden:o,validate_in:n,validation_on:i,c:this.topTotal,id:this.id},s=new Request.HTML({url:"index.php",data:l,update:d,onRequest:function(){r.debug&&fconsole("Fabrik pluginmanager: Adding",this.type,"entry",u.toString())}.bind(this),onSuccess:function(t){""!==e?this.addPlugin(e,u):c.getElement("span.pluginTitle").set("text",Joomla.JText._("COM_FABRIK_PLEASE_SELECT")),this.updateBootStrap(),FabrikAdmin.reTip()}.bind(this),onFailure:function(t){fconsole("Fabrik pluginmanager addTop ajax failed:",t)},onException:function(t,e){fconsole("Fabrik pluginmanager addTop ajax exception:",t,e)}});this.topTotal++,r.requestQueue.add(s)},updateBootStrap:function(){document.getElements(".radio.btn-group label").addClass("btn"),document.getElements(".btn-group input[checked=checked]").each(function(t){""===t.get("value")?document.getElement("label[for="+t.get("id")+"]").addClass("active btn-primary"):"0"===t.get("value")?document.getElement("label[for="+t.get("id")+"]").addClass("active btn-danger"):document.getElement("label[for="+t.get("id")+"]").addClass("active btn-success"),void 0!==e&&e("*[rel=tooltip]").tooltip()}),document.getElements(".hasTip").each(function(t){var e=t.get("title");e&&(e=e.split("::",2),t.store("tip:title",e[0]),t.store("tip:text",e[1]))});new Tips($$(".hasTip"),{maxTitleChars:50,fixed:!1});document.getElementById("adminForm").dispatchEvent(new CustomEvent("joomla:updated",{bubbles:!0,cancelable:!1}))},watchPluginSelect:function(){document.id("adminForm").addEvent("change:relay(select.elementtype)",function(t,e){t.preventDefault();var t=e.get("value"),n=e.getParent(".pluginContainer"),i=""!==t?t+" "+Joomla.JText._("COM_FABRIK_LOADING").toLowerCase():Joomla.JText._("COM_FABRIK_PLEASE_SELECT"),e=(e.getParent(".actionContainer").getElement("span.pluginTitle").set("text",i),n.id.replace("formAction_","").toInt());this.addPlugin(t,e)}.bind(this))},addPlugin:function(i,a){var t;a="number"===typeOf(a)?a:this.pluginTotal,""===i?document.id("plugins").getElements(".actionContainer")[a].getElement(".pluginOpts").empty():(t=new Request.HTML({url:"index.php",data:{option:"com_fabrik",view:"plugin",format:"raw",type:this.type,plugin:i,c:a,id:this.id},update:document.id("plugins").getElements(".actionContainer")[a].getElement(".pluginOpts"),onRequest:function(){r.debug&&fconsole("Fabrik pluginmanager: Loading",this.type,"type",i,"for entry",a.toString())}.bind(this),onSuccess:function(){var t=document.id("plugins").getElements(".actionContainer")[a],e=t.getElement("span.pluginTitle"),n=i,t=t.getElement("input[name*=plugin_description]");t&&(n+=": "+t.getValue()),e.set("text",n),this.pluginTotal++,this.updateBootStrap(),FabrikAdmin.reTip()}.bind(this),onFailure:function(t){fconsole("Fabrik pluginmanager addPlugin ajax failed:",t)},onException:function(t,e){fconsole("Fabrik pluginmanager addPlugin ajax exception:",t,e)}}),r.requestQueue.add(t))},deletePlugin:function(t){var n,e=t.target.getParent("fieldset.pluginContainer");"null"!==typeOf(e)&&(r.debug&&fconsole("Fabrik pluginmanager: Deleting",this.type,"entry",e.id,"and renaming later entries"),e.id.match(/_\d+$/)&&(n=e.id.match(/_(\d+)$/)[1].toInt(),document.id("plugins").getElements("input, select, textarea, label, fieldset").each(function(t){var e=t.name?t.name.match(/\[(\d+)\]/):null;(e=!(e=!e&&t.id?t.id.match(/-(\d+)/):e)&&"label"===t.get("tag").toLowerCase()&&t.get("for")?t.get("for").match(/-(\d+)/):e)&&(e=e[1].toInt(),n<e)&&(e--,t.name&&(t.name=t.name.replace(/(\[)(\d+)(\])/,"["+e+"]")),t.id&&(t.id=t.id.replace(/(-)(\d+)/,"-"+e)),"label"===t.get("tag").toLowerCase())&&t.get("for")&&t.set("for",t.get("for").replace(/(-)(\d+)/,"-"+e))}),document.id("plugins").getElements("fieldset.pluginContainer").each(function(t){var e;t.id.match(/formAction_\d+$/)&&(e=t.id.match(/formAction_(\d+)$/)[1].toInt(),n<e)&&(t.id=t.id.replace(/(formAction_)(\d+)$/,"$1"+(e-=1)))})),t.stop(),t.target.getParent(".actionContainer").dispose())}})});
//# sourceMappingURL=pluginmanager-min.js.map