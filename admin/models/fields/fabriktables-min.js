/*! Fabrik */
var fabriktablesElement=new Class({Implements:[Options,Events],options:{conn:null,connInRepeat:!0,container:""},initialize:function(e,t){this.el=e,this.setOptions(t),this.elements=[],this.elementLists=$H({}),this.waitingElements=$H({}),1!=t.isTemplate&&("null"===typeOf(document.id(this.options.conn))?this.periodical=this.getCnn.periodical(500,this):this.setUp())},getCnn:function(){"null"!==typeOf(document.id(this.options.conn))&&(this.setUp(),clearInterval(this.periodical))},registerElement:function(e){this.elements.push(e),this.updateElements()},setUp:function(){var t,e;this.el=document.id(this.el),this.cnn=document.id(this.options.conn),"null"!==this.cnn&&(this.loader=document.id(this.el.id+"_loader"),(t=this).cnn.hasClass("chosen-done")&&jQuery("#"+this.cnn.id).on("change",function(e){document.id(t.cnn).fireEvent("change",new Event.Mock(document.id(t.cnn),"change"))}),this.cnn.addEvent("change",function(e){this.updateMe(e)}.bind(this)),this.el.hasClass("chosen-done")&&jQuery("#"+this.el.id).on("change",function(e){document.id(t.el.id).fireEvent("change",new Event.Mock(document.id(t.el.id),"change"))}),this.el.addEvent("change",function(e){this.updateElements(e)}.bind(this)),""!==(e=this.cnn.get("value")))&&-1!==e&&this.updateMe()},updateMe:function(e){e&&e.stop();var e=this.cnn.get("value");e&&(this.loader&&this.loader.show(),e=new Request({url:"index.php",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",g:"element",plugin:"field",method:"ajax_tables",showf:"1",cid:e.toInt()},onSuccess:function(e){e=JSON.parse(e);"null"!==typeOf(e)&&(e.err?alert(e.err):(this.el.empty(),e.each(function(e){var t={value:e.id};e.id==this.options.value&&(t.selected="selected"),new Element("option",t).appendText(e.label).inject(this.el)}.bind(this)),this.loader&&this.loader.hide(!0),this.el.hasClass("chosen-done")&&jQuery("#"+this.el.id).trigger("chosen:updated"),this.updateElements()))}.bind(this),onFailure:function(e){console.log("fabriktables request failure",e.getResponseHeader("Status"))}.bind(this),onException:function(e,t){console.log("fabriktables request exception",e,t)}.bind(this)}),Fabrik.requestQueue.add(e))},updateElements:function(){this.elements.each(function(e){var t,i,n,s,l=e.getOpts();1!=l.isTemplate&&("string"==typeof this.el&&(this.el=document.id(this.el)),""!==(t=this.el.get("value")))&&(this.loader&&this.loader.show(),i=l.getValues().toString()+","+t,this.waitingElements.has(i)||(this.waitingElements[i]=$H({})),void 0!==this.elementLists[i]?""===this.elementLists[i]?this.waitingElements[i][e.el.id]=e:this.updateElementOptions(this.elementLists[i],e):(n=this.cnn.get("value"),this.elementLists.set(i,""),s={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",g:"element",plugin:"field",method:"ajax_fields",cid:n.toInt(),showf:"1",k:"2",t:t},l.each(function(e,t){s[t]=e}),new Request({url:"index.php",data:s,onComplete:function(n){this.elementLists.set(i,n),this.updateElementOptions(n,e),this.waitingElements.get(i).each(function(e,t){this.updateElementOptions(n,e),this.waitingElements[i].erase(t)}.bind(this))}.bind(this),onFailure:function(e){this.waitingElements.get(i).each(function(e,t){this.updateElementOptions("[]",e),this.waitingElements[i].erase(t)}.bind(this)),this.loader&&this.loader.hide(),alert(e.status+": "+e.statusText)}.bind(this)}).send()))}.bind(this))},updateElementOptions:function(r,element){var target,dotValue,table,key,opts,target,o;""!==r&&(table=document.id(this.el).get("value"),key=element.getOpts().getValues().toString()+","+table,opts=eval(r),target="textarea"===element.el.get("tag")?element.el.getParent().getElement("select"):element.el,target.empty(),o={value:""},""===element.options.value&&(o.selected="selected"),new Element("option",o).appendText("-").inject(target),dotValue=element.options.value.replace(".","___"),opts.each(function(e){var t=e.value.replace("[]",""),n={value:t};t!==element.options.value&&t!==dotValue||(n.selected="selected"),new Element("option",n).set("text",e.label).inject(target)}.bind(this)),this.loader)&&this.loader.hide(!0)},cloned:function(e,t){var n;!0===this.options.connInRepeat&&((n=this.options.conn.split("-")).pop(),this.options.conn=n.join("-")+"-"+t),this.el=e,this.elements=[],this.elementLists=$H({}),this.waitingElements=$H({}),this.setUp(),FabrikAdmin.model.fields.fabriktable[this.el.id]=this}});
//# sourceMappingURL=fabriktables-min.js.map