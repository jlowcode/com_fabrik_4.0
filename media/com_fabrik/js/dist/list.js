/*! Fabrik */

define(["jquery","fab/fabrik","fab/list-toggle","fab/list-grouped-toggler","fab/list-keys","fab/list-actions","lib/debounce/jquery.ba-throttle-debounce","fab/mootools-ext"],(function(t,i,e,s,o,a,n){var r=new Class({Binds:[],Implements:[Options,Events],actionManager:null,options:{admin:!1,filterMethod:"onchange",ajax:!1,ajax_links:!1,links:{edit:"",detail:"",add:""},form:"listform_"+this.id,hightLight:"#ccffff",primaryKey:"",headings:[],labels:{},Itemid:0,formid:0,canEdit:!0,canView:!0,page:"index.php",actionMethod:"floating",formels:[],data:[],itemTemplate:"",floatPos:"left",csvChoose:!1,advancedFilters:null,csvOpts:{excel:!1,incfilters:!1,inctabledata:!1,incraw:!1,inccalcs:!1},popup_width:300,popup_height:300,popup_offset_x:null,popup_offset_y:null,groupByOpts:{},isGrouped:!1,listRef:"",fabrik_show_in_list:[],singleOrdering:!1,tmpl:"",groupedBy:"",toggleCols:!1},initialize:function(t,a){var n=this;this.id=t,this.setOptions(a),this.getForm(),this.result=!0,this.plugins=[],this.list=document.id("list_"+this.options.listRef),this.rowTemplate=!1,this.options.toggleCols&&(this.toggleCols=new e(this.form)),this.groupToggle=new s(this.form,this.options.groupByOpts),new o(this),this.list&&("table"===this.list.get("tag")&&(this.tbody=this.list.getElement("tbody")),"null"===typeOf(this.tbody)&&(this.tbody=this.list.getElement(".fabrik_groupdata")),window.ie&&(this.options.itemTemplate=this.list.getElement(".fabrik_row"))),this.watchAll(!1),i.addEvent("fabrik.form.submitted",(function(){n.updateRows()})),i.addEvent("fabrik.list.dofilter",(function(){n.doFilter()})),i.addEvent("fabrik.list.watchfilters",(function(){n.watchFilters()})),!this.options.resetFilters&&window.history&&history.pushState&&history.state&&this.options.ajax&&this._updateRows(history.state),this.mediaScan(),i.fireEvent("fabrik.list.loaded",[this])},setItemTemplate:function(){if("string"===typeOf(this.options.itemTemplate)){var t=this.list.getElement(".fabrik_row");window.ie&&"null"!==typeOf(t)&&(this.options.itemTemplate=t)}},setRowTemplate:function(i){return this.rowTemplate||(this.rowTemplate=i.clone().empty(),0===this.rowTemplate.length&&(this.rowTemplate=t(this.tbody).children().not(".groupDataMsg").first())),this.rowTemplate},rowClicks:function(){var e,s,o=this;t(this.list).on("click",".fabrik_row",(function(){e=this.id.split("_").pop(),s={errors:{},data:{rowid:e},rowid:e,listid:o.id},i.fireEvent("fabrik.list.row.selected",s)}))},watchAll:function(t){t=t||!1,this.watchNav(),this.storeCurrentValue(),t||(this.watchRows(),this.watchFilters()),this.watchOrder(),this.watchEmpty(),t||(this.watchGroupByMenu(),this.watchButtons())},watchGroupByMenu:function(){var i=this;this.options.ajax&&t(this.form).on("click","*[data-groupBy]",(function(e){i.options.groupedBy=t(this).data("groupby"),e.rightClick||(e.preventDefault(),i.updateRows())}))},watchButtons:function(){var i=this;this.exportWindowOpts={modalId:"exportcsv",type:"modal",id:"exportcsv",title:"Export CSV",loadMethod:"html",minimizable:!1,width:360,height:240,content:"",modal:!0,bootstrap:!0,visible:!0,onContentLoaded:function(){var t=this;window.setTimeout((function(){t.fitToContent()}),1e3)}},this.exportWindowOpts.width=parseInt(this.options.csvOpts.popupwidth,10)>0?this.options.csvOpts.popupwidth:360,this.exportWindowOpts.optswidth=parseInt(this.options.csvOpts.optswidth,10)>0?this.options.csvOpts.optswidth:240,"csv"===this.options.view?this.openCSVWindow():t(this.form).find(".csvExportButton").each((function(e,s){!1===(s=t(s)).hasClass("custom")&&s.on("click",(function(t){t.preventDefault(),i.openCSVWindow()}))}))},openCSVWindow:function(){var e=this;this.exportWindowOpts.content=this.makeCSVExportForm(),this.csvWindow=i.getWindow(this.exportWindowOpts),t(".exportCSVButton").on("click",(function(i){i.stopPropagation(),this.disabled=!0,t(this).hide(),t(this).closest("div.modal").find(".contentWrapper").hide();var s=t("#csvmsg");0===s.length&&(s=t("<div />").attr({id:"csvmsg"}).insertBefore(t(this))),s.html(Joomla.JText._("COM_FABRIK_LOADING")+' <p><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+'</p><p class="saveto">'+Joomla.JText._("COM_FABRIK_SAVING_TO")+' <span id="csvfile"></span></p>'),e.triggerCSVExport(0)}))},makeCSVExportForm:function(){return this.options.csvChoose?(this.csvExportForm=this._csvExportForm(),this.csvExportForm):this._csvAutoStart()},_csvAutoStart:function(){var i=t("<div />").attr({id:"csvmsg"}).html(Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>');return this.csvopts=this.options.csvOpts,this.csvfields=this.options.csvFields,this.triggerCSVExport(-1),i},makeSafeForCSS:function(t){return t.replace(/[^a-z0-9]/g,(function(t){var i=t.charCodeAt(0);return 32==i?"-":i>=65&&i<=90?t.toLowerCase():("000"+i.toString(16)).slice(-4)}))},_csvYesNo:function(i,e,s,o,a){var n=t("<label />").css({display:"inline-block","margin-left":"15px"}),r=n.clone().append([t("<input />").attr({type:"radio",name:i,value:"1",checked:e}),t("<span />").text(s)]),l=n.clone().append([t("<input />").attr({type:"radio",name:i,value:"0",checked:!e}),t("<span />").text(o)]),c=t("<div>").css({margin:"3px 0px 1px 8px",width:this.exportWindowOpts.optswidth+"px",float:"left"}).text(a),p="opt__"+this.makeSafeForCSS(a);return t('<div class="'+p+'">').css({"border-bottom":"1px solid #dddddd"}).append([c,r,l])},_csvExportForm:function(){var e,s,o=Joomla.JText._("JYES"),a=Joomla.JText._("JNO"),n=this,r=i.liveSite+"/index.php?option=com_fabrik&view=list&listid="+this.id+"&format=csv&Itemid="+this.options.Itemid,l=(t("<label />").css("clear","left"),t("<form />").css("margin-bottom","0px").attr({action:r,method:"post"}).append([this._csvYesNo("excel",this.options.csvOpts.excel,"Excel CSV","CSV",Joomla.JText._("COM_FABRIK_FILE_TYPE")),this._csvYesNo("incfilters",this.options.csvOpts.incfilters,o,a,Joomla.JText._("COM_FABRIK_INCLUDE_FILTERS")),this._csvYesNo("inctabledata",this.options.csvOpts.inctabledata,o,a,Joomla.JText._("COM_FABRIK_INCLUDE_DATA")),this._csvYesNo("incraw",this.options.csvOpts.incraw,o,a,Joomla.JText._("COM_FABRIK_INCLUDE_RAW_DATA")),this._csvYesNo("inccalcs",this.options.csvOpts.inccalcs,o,a,Joomla.JText._("COM_FABRIK_INCLUDE_CALCULATIONS"))]));s=Joomla.JText._("COM_FABRIK_SELECT_COLUMNS_TO_EXPORT"),e="opt__"+n.makeSafeForCSS(s),t("<div />").prop("class",e).text(s).appendTo(l);var c="";return t.each(this.options.labels,(function(i,s){if("fabrik_"!==i.substr(0,7)&&"____form_heading"!==i){var r=i.split("___")[0];r!==c&&(c=r,e="opt__"+n.makeSafeForCSS(c),t("<div />").prop("class",e).css({clear:"left","font-weight":"600"}).text(c).appendTo(l)),s=s.replace(/<\/?[^>]+(>|jQuery)/g,""),n._csvYesNo("fields["+i+"]",!0,o,a,s).appendTo(l)}0})),this.options.formels.length>0&&(s=Joomla.JText._("COM_FABRIK_FORM_FIELDS"),e="opt__"+n.makeSafeForCSS(s),t("<div />").prop("class",e).text(s).appendTo(l),this.options.formels.each((function(t){n._csvYesNo("fields["+t.name+"]",!1,o,a,t.label).appendTo(l)}))),t("<input />").attr({type:"hidden",name:"view",value:"table"}).appendTo(l),t("<input />").attr({type:"hidden",name:"option",value:"com_fabrik"}).appendTo(l),t("<input />").attr({type:"hidden",name:"listid",value:n.id}).appendTo(l),t("<input />").attr({type:"hidden",name:"format",value:"csv"}).appendTo(l),t("<input />").attr({type:"hidden",name:"c",value:"table"}).appendTo(l),l},triggerCSVExport:function(e,s,o){var a=this;0!==e?-1===e?(e=0,(s=a.csvopts).fields=a.csvfields):(s=a.csvopts,o=a.csvfields):(s||(s={},["incfilters","inctabledata","incraw","inccalcs","excel"].each((function(t){var i=a.csvExportForm.find("input[name="+t+"]");i.length>0&&(s[t]=i.filter((function(){return this.checked}))[0].value)}))),o||(o={},a.csvExportForm.find("input[name^=field]").each((function(){if(this.checked){var i=this.name.replace("fields[","").replace("]","");o[i]=t(this).val()}}))),s.fields=o,a.csvopts=s,a.csvfields=o),(s=this.csvExportFilterOpts(s)).start=e,s.option="com_fabrik",s.view="list",s.format="csv",s.listid=this.id,s.listref=this.options.listRef,s.download=0,s.setListRefFromRequest=1;var n="?Itemid="+this.options.Itemid;this.options.csvOpts.custom_qs.split("&").each((function(t){n+="&"+t})),new Request.JSON({url:n,method:"post",data:s,onError:function(t,i){fconsole(t,i)},onComplete:function(e){if(e.err)window.alert(e.err),i.Windows.exportcsv.close();else if(t("#csvcount").text(e.count),t("#csvtotal").text(e.total),t("#csvfile").text(e.file),e.count<e.total)a.triggerCSVExport(e.count);else{var s;a.options.admin?s=i.liveSite+"administrator/index.php?option=com_fabrik&task=list.view&format=csv&listid="+a.id+"&start="+e.count:(s=a.options.csvOpts.exportLink,s+=s.contains("?")?"&":"?",s+="start="+e.count),s+="&"+a.options.csvOpts.custom_qs;var o='<div class="alert alert-success" style="padding:10px;margin-bottom:3px"><h3>'+Joomla.JText._("COM_FABRIK_CSV_COMPLETE");o+='</h3><p><a class="btn btn-success" href="'+s+'"><i class="icon-download"></i> '+Joomla.JText._("COM_FABRIK_CSV_DOWNLOAD_HERE")+"</a></p></div>",t("#csvmsg").html(o),document.getElements("input.exportCSVButton").removeProperty("disabled"),t("#csvmsg a.btn-success").focusout((function(){i.Windows.exportcsv.close(!0)})),a.csvWindow.fitToContent()}}}).send()},csvExportFilterOpts:function(i){var e,s,o,a,n=0,r=this,l=0,c=["value","condition","join","key","search_type","match","full_words_only","eval","grouped_to_previous","hidden","elementid"];return this.getFilters().each((function(e,o){o=t(o),(s=o.prop("name").split("[")).length>3&&(a=parseInt(s[3].replace("]",""),10),n=a>n?a:n,"checkbox"===o.prop("type")||"radio"===o.prop("type")?o[0].checked&&(i[o.name]=o.val()):i[o.name]=o.val())})),n++,Object.each(this.options.advancedFilters,(function(t,s){if(c.contains(s))for(l=0,e=0;e<t.length;e++)l=e+n,o="fabrik___filter[list_"+r.options.listRef+"]["+s+"]["+l+"]",i[o]="value"===s?r.options.advancedFilters.origvalue[e]:"condition"===s?r.options.advancedFilters.orig_condition[e]:t[e]})),i},addPlugins:function(t){var i=this;t.each((function(t){t.list=i})),this.plugins=t},firePlugin:function(t){var e=Array.prototype.slice.call(arguments),s=this;return e=e.slice(1,e.length),this.plugins.each((function(o){i.fireEvent(t,[s,e])})),!1!==this.result},watchEmpty:function(){var i=this;t(this.form).find(".doempty").on("click",(function(t){t.preventDefault(),window.confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DROP"))&&i.submit("list.doempty")}))},watchOrder:function(){var e,s,o,a,n=!1,r=t(this.form),l=this,c=r.find(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc");c.off("click"),c.on("click",(function(c){var p="",d="",h="",f="",u=t(this),m=u.closest(".fabrik_ordercell");switch("A"!==u.prop("tagName")&&(u=m.find("a")),u.attr("class")){case"fabrikorder-asc":d="fabrikorder-desc",h=u.data("data-sort-desc-icon"),f=u.data("data-sort-asc-icon"),p="desc","orderdesc.png";break;case"fabrikorder-desc":d="fabrikorder",h=u.data("data-sort-icon"),f=u.data("data-sort-desc-icon"),p="-","ordernone.png";break;case"fabrikorder":d="fabrikorder-asc",h=u.data("data-sort-asc-icon"),f=u.data("data-sort-icon"),p="asc","orderasc.png"}m.attr("class").split(" ").each((function(t){t.contains("_order")&&(n=t.replace("_order","").replace(/^\s+/g,"").replace(/\s+$/g,""))})),n?(u.attr("class",d),i.bootstrapped?s=u.find("*[data-isicon]"):(e=u.find("img"),s=u.firstElementChild),l.options.singleOrdering&&r.find(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc").each((function(t){if(i.bootstrapped)switch(o=t.firstElementChild,t.className){case"fabrikorder-asc":o.removeClass(t.data("sort-asc-icon")),o.addClass(t.data("sort-icon"));break;case"fabrikorder-desc":o.removeClass(t.data("sort-desc-icon")),o.addClass(t.data("sort-icon"))}else(e=t.find("img")).length>0&&(a=(a=e.attr("src")).replace("ordernone.png","").replace("orderasc.png","").replace("orderdesc.png",""),a+="ordernone.png",e.attr("src",a))})),i.bootstrapped?(s.removeClass(f),s.addClass(h)):e&&(a=(a=e.attr("src")).replace("ordernone.png","").replace("orderasc.png","").replace("orderdesc.png",""),e.attr("src",a)),l.fabrikNavOrder(n,p),c.preventDefault()):fconsole("woops didnt find the element id, cant order")}))},getFilters:function(){return t(this.form).find(".fabrik_filter")},storeCurrentValue:function(){"submitform"!==this.options.filterMethod&&this.getFilters().each((function(i,e){(e=t(e)).data("initialvalue",e.val())}))},addSearchedTag:function(i){t(".filteredTags")[0]&&t(".filteredTags").append('<span tag-value="'+i+'" class="tagSearched">'+i+"</span>")},deleteSearchedTag:function(i){var e=t(".filteredTags")[0];e&&t(e).find("span[tag-value='"+i+"']")[0]&&t(e).find("span[tag-value='"+i+"']")[0].remove()},watchFilters:function(){var i="",e=this,s=t(this.form).find(".fabrik_filter_submit");this.getFilters().each((function(s,o){o=t(o),i="SELECT"===o.prop("tagName")||"checkbox"===o.prop("type")||"radio"===o.prop("type")?"change":"blur";var a="";"text"===o.prop("type")&&o.hasClass("single_field")&&o.bind("keyup",n(1e3,(function(t){e.doFilter(),a!=o.val()&&(e.deleteSearchedTag(a),a=o.val(),e.addSearchedTag(o.val()))}))),"checkbox"!==o.prop("type")&&"radio"!==o.prop("type")&&"SELECT"!==o.prop("tagName")&&"submitform"===e.options.filterMethod||(o.off(i),o.on(i,(function(i){if(i.preventDefault(),"checkbox"===o.prop("type")||"radio"===o.prop("type")||"SELECT"===o.prop("tagName")||o.data("initialvalue")!==o.val()){if(t(".filteredTags")[0]&&("checkbox"===o.prop("type")&&o.prop("checked")?e.addSearchedTag(o.prop("value")):e.deleteSearchedTag(o.prop("value")),"SELECT"===o.prop("tagName")&&""!=o.val())){var s="",a=t("#"+o.prop("id")+" option:selected").text();o.change((function(){s=a,a=o.val(),e.deleteSearchedTag(s)})),a&&""!=a&&e.addSearchedTag(a)}e.doFilter()}})))})),s.off(),s.on("click",(function(t){t.preventDefault(),e.doFilter()})),this.getFilters().on("keydown",(function(t){13===t.keyCode&&(t.preventDefault(),e.doFilter())}))},doFilter:function(){var t=i.fireEvent("list.filter",[this]).eventResults;null===t&&this.submit("list.filter"),0!==t.length&&t.contains(!1)||this.submit("list.filter")},setActive:function(t){this.list.getElements(".fabrik_row").each((function(t){t.removeClass("activeRow")})),t.addClass("activeRow")},getActiveRow:function(e){var s=t(e.target).closest(".fabrik_row");return 0===s.length&&(s=i.activeRow),s},watchRows:function(){this.list&&this.rowClicks()},getForm:function(){return this.form||(this.form=document.id(this.options.form)),this.form},uncheckAll:function(){t(this.form).find("input[name^=ids]").each((function(t,i){i.checked=""}))},submitDeleteCheck:function(){var e=!1,s=0;if(t(this.form).find("input[name^=ids]").each((function(t,i){i.checked&&(s++,e=!0)})),!e)return window.alert(Joomla.JText._("COM_FABRIK_SELECT_ROWS_FOR_DELETION")),i.loader.stop("listform_"+this.options.listRef),!1;var o=1===s?Joomla.JText._("COM_FABRIK_CONFIRM_DELETE_1"):Joomla.JText._("COM_FABRIK_CONFIRM_DELETE").replace("%s",s);return!!window.confirm(o)||(i.loader.stop("listform_"+this.options.listRef),this.uncheckAll(),!1)},submit:function(e){this.getForm();var s=!0,o=this,a=t(this.form);if("list.doPlugin.noAJAX"===e&&(e="list.doPlugin",s=!1),"list.delete"===e&&!this.submitDeleteCheck())return!1;if("list.filter"===e?(i["filter_listform_"+this.options.listRef].onSubmit(),this.form.task.value=e,this.form["limitstart"+this.id]&&a.find("#limitstart"+this.id).val(0)):"list.view"===e?i["filter_listform_"+this.options.listRef].onSubmit():""!==e&&(this.form.task.value=e),s){i.loader.start("listform_"+this.options.listRef),a.find("input[name=option]").val("com_fabrik"),a.find("input[name=view]").val("list"),a.find("input[name=format]").val("raw");var n=this.form.toQueryString();if(n+="&setListRefFromRequest=1",n+="&listref="+this.options.listRef,n+="&Itemid="+this.options.Itemid,"list.filter"===e&&!1!==this.advancedSearch){var r=document.getElement("form.advancedSearch_"+this.options.listRef);"null"!==typeOf(r)&&(n+="&"+r.toQueryString(),n+="&replacefilters=1")}for(var l=0;l<this.options.fabrik_show_in_list.length;l++)n+="&fabrik_show_in_list[]="+this.options.fabrik_show_in_list[l];n+="&tmpl="+this.options.tmpl,this.request?this.request.options.data=n:this.request=new Request({url:this.form.get("action"),data:n,onComplete:function(e){e=JSON.parse(e),o._updateRows(e),i.loader.stop("listform_"+o.options.listRef),i["filter_listform_"+o.options.listRef].onUpdateData(),i["filter_listform_"+o.options.listRef].updateFilterCSS(e),t("#searchall_"+o.options.listRef).val(e.searchallvalue);const s=t("#searchall_"+o.options.listRef).val(),a=t(document.getElementById("searchTag"));""!=s&&" "!=s?(a.css({padding:"2px 8px 2px 8px","border-radius":"10px","background-color":"#EEEEEF","font-weight":"normal"}),a.text(s)):(a.text(""),a.css({"border-radius":"10px","background-color":"#FFF"})),i.fireEvent("fabrik.list.submit.ajax.complete",[o,e]),e.msg&&e.showmsg&&window.alert(e.msg)}}),this.request.send(),window.history&&window.history.pushState&&history.pushState(n,"fabrik.list.submit"),i.fireEvent("fabrik.list.submit",[e,this.form.toQueryString().toObject()])}else this.form.submit();return!1},fabrikNav:function(t){return this.options.limitStart=t,this.form.getElement("#limitstart"+this.id).value=t,i.fireEvent("fabrik.list.navigate",[this,t]),this.result?(this.submit("list.view"),!1):(this.result=!0,!1)},getRowIds:function(){var t=[];return(this.options.isGrouped?$H(this.options.data):this.options.data).each((function(i){i.each((function(i){t.push(i.data.__pk_val)}))})),t},getCheckedRowIds:function(){return this.getForm().getElements("input[name^=ids]").filter((function(t){return t.checked})).map((function(t){return t.get("value")}))},getRow:function(t){var i={};return Object.each(this.options.data,(function(e){for(var s=0;s<e.length;s++){var o=e[s];o&&o.data.__pk_val==t&&(i=o.data)}})),i},fabrikNavOrder:function(t,e){if(this.form.orderby.value=t,this.form.orderdir.value=e,i.fireEvent("fabrik.list.order",[this,t,e]),!this.result)return this.result=!0,!1;this.submit("list.order")},removeRows:function(t){var i,e=this,s=function(){o.dispose(),e.checkEmpty()};for(i=0;i<t.length;i++){var o=document.id("list_"+e.id+"_row_"+t[i]);new Fx.Morph(o,{duration:1e3}).start({backgroundColor:this.options.hightLight}).chain((function(){this.start({opacity:0})})).chain(s)}},editRow:function(){},clearRows:function(){this.list.getElements(".fabrik_row").each((function(t){t.dispose()}))},updateRows:function(t){var i=this,e={option:"com_fabrik",view:"list",task:"list.view",format:"raw",listid:this.id,listref:this.options.listRef};e["limit"+this.id]=this.options.limitLength,t&&Object.append(e,t),""!==this.options.groupedBy&&(e.group_by=this.options.groupedBy),new Request({url:"",data:e,evalScripts:!1,onSuccess:function(t){t=t.stripScripts(),t=JSON.parse(t),i._updateRows(t)},onError:function(t,i){fconsole(t,i)},onFailure:function(t){fconsole(t)}}).send()},_updateHeadings:function(i){var e=t("#"+this.options.form).find(".fabrik___heading");t.each(i.headings,(function(t,i){t="."+t;try{e.find(t+" span").html(i)}catch(t){fconsole(t)}}))},_updateGroupByTables:function(){var i,e=t(this.list).find("tbody");e.css("display",""),e.each((function(e,s){s.hasClass("fabrik_groupdata")||(i=t(s).next(),0===t(i).find(".fabrik_row").length&&(t(s).hide(),t(i).hide()))}))},_updateRows:function(e){var s,o,a,n,r,l,c,p,d,h,f=[],u=t(this.form),m=this,v="tr";if("object"===typeOf(e)&&(window.history&&window.history.pushState&&history.pushState(e,"fabrik.list.rows"),e.id==this.id&&"list"===e.model)){this._updateHeadings(e),this.setItemTemplate(),0===(p=t(this.list).find(".fabrik_row").first()).length&&(p=t(this.options.itemTemplate)),"TR"===p.prop("tagName")?(r=p,n=1,v="tr"):(r=p.parent(),n=u.find(".fabrikDataContainer").data("cols"),v="div"),n=void 0===n?1:n,c=this.setRowTemplate(r),o=p.clone(),this.clearRows(),this.options.data=this.options.isGrouped?$H(e.data):e.data,e.calculations&&this.updateCals(e.calculations),u.find(".fabrikNav").html(e.htmlnav);var _=this.options.isGrouped||""!==this.options.groupedBy?$H(e.data):e.data,g=0;_.each((function(e,r){for(s=m.options.isGrouped?m.list.getElements(".fabrik_groupdata")[g]:m.tbody,(s=t(s)).children().not(".groupDataMsg").remove(),m.options.isGrouped&&s.prev().find(".groupTitle").html(e[0].groupHeading),f=[],g++,a=0;a<e.length;a++){var p=$H(e[a]);l=m.injectItemData(o,p,v),f.push(l)}for(f=i.Array.chunk(f,n),a=0;a<f.length;a++)"div"===v?(d=f[a],h=c.clone().append(d)):h=f[a],s.append(h)})),this._updateGroupByTables(),this._updateEmptyDataMsg(0===f.length),this.watchAll(!0),i.fireEvent("fabrik.list.updaterows"),i.fireEvent("fabrik.list.update",[this,e]),this.stripe(),this.mediaScan(),i.loader.stop("listform_"+this.options.listRef)}},_updateEmptyDataMsg:function(i){var e=t(this.list),s=e.parent(".fabrikDataContainer"),o=e.closest(".fabrikForm").find(".emptyDataMessage");i?(o.css("display",""),"none"===o.parent().css("display")&&o.parent().css("display",""),o.parent(".emptyDataMessage").css("display","")):(s.css("display",""),o.css("display","none"))},injectItemData:function(i,e,s){var o,a,n,r;if(t.each(e.data,(function(e,s){var o;if("A"!==(a=i.find("."+e)).prop("tagName"))a.html(s);else try{o=t(s).prop("href");var n=t(s).data("rowid");t.each(a,(function(i,e){0===t(e).data("iscustom")&&(t(e).prop("href",o),t(e).data("rowid",n))}))}catch(t){a.prop("href",s)}})),"string"==typeof this.options.itemTemplate){if((n=i.find(".fabrik_row").addBack(i)).prop("id",e.id),"div"!==s){n.removeClass();var l=e.class.split(/\s+/);for(r=0;r<l.length;r++)n.addClass(l[r])}else{n.removeClass("oddRow0"),n.removeClass("oddRow1");l=e.class.split(/\s+/);for(r=0;r<l.length;r++)n.hasClass(l[r])||n.addClass(l[r])}o=i.clone()}else o=i.find(".fabrik_row").addBack(i);return o},mediaScan:function(){"undefined"!=typeof Slimbox&&Slimbox.scanPage(),"undefined"!=typeof Lightbox&&Lightbox.init(),"undefined"!=typeof Mediabox&&Mediabox.scanPage()},addRow:function(t){var i=new Element("tr",{class:"oddRow1"});for(var e in t)if(-1!==this.options.headings.indexOf(e)){var s=new Element("td",{}).appendText(t[e]);i.appendChild(s)}i.inject(this.tbody)},addRows:function(t){var i,e;for(i=0;i<t.length;i++)for(e=0;e<t[i].length;e++)this.addRow(t[i][e]);this.stripe()},stripe:function(){var t,i=this.list.getElements(".fabrik_row");for(t=0;t<i.length;t++)if(!i[t].hasClass("fabrik___header")){var e="oddRow"+t%2;i[t].addClass(e)}},checkEmpty:function(){2===this.list.getElements("tr").length&&this.addRow({label:Joomla.JText._("COM_FABRIK_NO_RECORDS")})},watchCheckAll:function(){var i,e,s,o,a=t(this.form),n=a.find("input[name=checkAll]"),r=this,l=t(this.list);n.on("click",(function(t){for(s=l.closest(".fabrikList").length>0?l.closest(".fabrikList"):l,o=s.find("input[name^=ids]"),i=t.target.checked?"checked":"",e=0;e<o.length;e++)o[e].checked=i,r.toggleJoinKeysChx(o[e])})),a.find("input[name^=ids]").each((function(i,e){t(e).on("change",(function(){r.toggleJoinKeysChx(e)}))}))},toggleJoinKeysChx:function(t){t.getParent().getElements("input[class=fabrik_joinedkey]").each((function(i){i.checked=t.checked}))},watchNav:function(e){var s,o,a=t(this.form),n=a.find("select[name*=limit]"),r=a.find(".addRecord"),l=this;if(n.on("change",(function(){if(i.fireEvent("fabrik.list.limit",[l]),!1===l.result)return l.result=!0,!1;l.doFilter()})),this.options.ajax_links&&r.length>0){r.off(),o=r.prop("href"),s=""===this.options.links.add||o.contains(i.liveSite)?"xhr":"iframe";var c=o;c+=c.contains("?")?"&":"?",c+="tmpl=component&ajax=1",c+="&format=partial",r.on("click",(function(t){t.preventDefault();var e={id:"add."+l.id,title:l.options.popup_add_label,loadMethod:s,contentURL:c,width:l.options.popup_width,height:l.options.popup_height};null!==l.options.popup_offset_x&&(e.offset_x=l.options.popup_offset_x),null!==l.options.popup_offset_y&&(e.offset_y=l.options.popup_offset_y),i.getWindow(e)}))}t("#fabrik__swaptable").on("change",(function(){window.location="index.php?option=com_fabrik&task=list.view&cid="+this.value}));var p=a.find(".pagination .pagenav");0===p.length&&(p=a.find(".pagination a")),t(p).on("click",(function(t){if(t.preventDefault(),"A"===this.tagName){var i=this.href.toObject();l.fabrikNav(i["limitstart"+l.id])}})),this.watchCheckAll()},updateCals:function(t){var i=["sums","avgs","count","medians"];this.form.getElements(".fabrik_calculations").each((function(e){i.each((function(i){$H(t[i]).each((function(t,i){var s=e.getElement("."+i);"null"!==typeOf(s)&&s.set("html",t)}))}))}))}});return r}));