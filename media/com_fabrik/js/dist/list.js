/*! Fabrik */
define(["jquery","fab/fabrik","fab/list-toggle","fab/list-grouped-toggler","fab/list-keys","fab/list-actions","fab/mootools-ext"],function(m,v,s,o,n,t){return new Class({Binds:[],Implements:[Options,Events],actionManager:null,options:{admin:!1,filterMethod:"onchange",ajax:!1,ajax_links:!1,links:{edit:"",detail:"",add:""},form:"listform_"+this.id,hightLight:"#ccffff",primaryKey:"",headings:[],labels:{},Itemid:0,formid:0,canEdit:!0,canView:!0,page:"index.php",actionMethod:"floating",formels:[],data:[],itemTemplate:"",floatPos:"left",csvChoose:!1,advancedFilters:null,csvOpts:{excel:!1,incfilters:!1,inctabledata:!1,incraw:!1,inccalcs:!1},popup_width:300,popup_height:300,popup_offset_x:null,popup_offset_y:null,groupByOpts:{},isGrouped:!1,listRef:"",fabrik_show_in_list:[],singleOrdering:!1,tmpl:"",groupedBy:"",toggleCols:!1},initialize:function(t,i){var e=this;this.id=t,this.setOptions(i),this.getForm(),this.result=!0,this.plugins=[],this.list=document.id("list_"+this.options.listRef),this.rowTemplate=!1,this.options.toggleCols&&(this.toggleCols=new s(this.form)),this.groupToggle=new o(this.form,this.options.groupByOpts),new n(this),this.list&&("table"===this.list.get("tag")&&(this.tbody=this.list.getElement("tbody")),"null"===typeOf(this.tbody)&&(this.tbody=this.list.getElement(".fabrik_groupdata")),window.ie)&&(this.options.itemTemplate=this.list.getElement(".fabrik_row")),this.watchAll(!1),v.addEvent("fabrik.form.submitted",function(){e.updateRows()}),!this.options.resetFilters&&window.history&&history.pushState&&history.state&&this.options.ajax&&this._updateRows(history.state),this.mediaScan(),v.fireEvent("fabrik.list.loaded",[this])},setItemTemplate:function(){var t;"string"===typeOf(this.options.itemTemplate)&&(t=this.list.getElement(".fabrik_row"),window.ie)&&"null"!==typeOf(t)&&(this.options.itemTemplate=t)},setRowTemplate:function(t){return this.rowTemplate||(this.rowTemplate=t.clone().empty(),0===this.rowTemplate.length&&(this.rowTemplate=m(this.tbody).children().not(".groupDataMsg").first())),this.rowTemplate},rowClicks:function(){var t,i=this;m(this.list).on("click",".fabrik_row",function(){t=this.id.split("_").pop(),t={errors:{},data:{rowid:t},rowid:t,listid:i.id},v.fireEvent("fabrik.list.row.selected",t)})},watchAll:function(t){t=t||!1,this.watchNav(),this.storeCurrentValue(),t||(this.watchRows(),this.watchFilters()),this.watchOrder(),this.watchEmpty(),t||(this.watchGroupByMenu(),this.watchButtons())},watchGroupByMenu:function(){var i=this;this.options.ajax&&m(this.form).on("click","*[data-groupBy]",function(t){i.options.groupedBy=m(this).data("groupby"),t.rightClick||(t.preventDefault(),i.updateRows())})},watchButtons:function(){var e=this;this.exportWindowOpts={modalId:"exportcsv",type:"modal",id:"exportcsv",title:"Export CSV",loadMethod:"html",minimizable:!1,width:360,height:240,content:"",modal:!0,bootstrap:!0,visible:!0,onContentLoaded:function(){var t=this;window.setTimeout(function(){t.fitToContent()},1e3)}},this.exportWindowOpts.width=0<parseInt(this.options.csvOpts.popupwidth,10)?this.options.csvOpts.popupwidth:360,this.exportWindowOpts.optswidth=0<parseInt(this.options.csvOpts.optswidth,10)?this.options.csvOpts.optswidth:240,"csv"===this.options.view?this.openCSVWindow():m(this.form).find(".csvExportButton").each(function(t,i){!1===(i=m(i)).hasClass("custom")&&i.on("click",function(t){t.preventDefault(),e.openCSVWindow()})})},openCSVWindow:function(){var i=this;this.exportWindowOpts.content=this.makeCSVExportForm(),this.csvWindow=v.getWindow(this.exportWindowOpts),m(".exportCSVButton").on("click",function(t){t.stopPropagation(),this.disabled=!0,m(this).hide(),m(this).closest("div.modal").find(".contentWrapper").hide();t=m("#csvmsg");(t=0===t.length?m("<div />").attr({id:"csvmsg"}).insertBefore(m(this)):t).html(Joomla.JText._("COM_FABRIK_LOADING")+' <p><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+'</p><p class="saveto">'+Joomla.JText._("COM_FABRIK_SAVING_TO")+' <span id="csvfile"></span></p>'),i.triggerCSVExport(0)})},makeCSVExportForm:function(){return this.options.csvChoose?(this.csvExportForm=this._csvExportForm(),this.csvExportForm):this._csvAutoStart()},_csvAutoStart:function(){var t=m("<div />").attr({id:"csvmsg"}).html(Joomla.JText._("COM_FABRIK_LOADING")+' <br /><span id="csvcount">0</span> / <span id="csvtotal"></span> '+Joomla.JText._("COM_FABRIK_RECORDS")+".<br/>"+Joomla.JText._("COM_FABRIK_SAVING_TO")+'<span id="csvfile"></span>');return this.csvopts=this.options.csvOpts,this.csvfields=this.options.csvFields,this.triggerCSVExport(-1),t},makeSafeForCSS:function(t){return t.replace(/[^a-z0-9]/g,function(t){var i=t.charCodeAt(0);return 32==i?"-":65<=i&&i<=90?t.toLowerCase():("000"+i.toString(16)).slice(-4)})},_csvYesNo:function(t,i,e,s,o){var n=m("<label />").css({display:"inline-block","margin-left":"15px"}),e=n.clone().append([m("<input />").attr({type:"radio",name:t,value:"1",checked:i}),m("<span />").text(e)]),n=n.clone().append([m("<input />").attr({type:"radio",name:t,value:"0",checked:!i}),m("<span />").text(s)]),t=m("<div>").css({margin:"3px 0px 1px 8px",width:this.exportWindowOpts.optswidth+"px",float:"left"}).text(o),i="opt__"+this.makeSafeForCSS(o);return m('<div class="'+i+'">').css({"border-bottom":"1px solid #dddddd"}).append([t,e,n])},_csvExportForm:function(){var s=Joomla.JText._("JYES"),o=Joomla.JText._("JNO"),n=this,t=v.liveSite+"/index.php?option=com_fabrik&view=list&listid="+this.id+"&format=csv&Itemid="+this.options.Itemid,a=(m("<label />").css("clear","left"),m("<form />").css("margin-bottom","0px").attr({action:t,method:"post"}).append([this._csvYesNo("excel",this.options.csvOpts.excel,"Excel CSV","CSV",Joomla.JText._("COM_FABRIK_FILE_TYPE")),this._csvYesNo("incfilters",this.options.csvOpts.incfilters,s,o,Joomla.JText._("COM_FABRIK_INCLUDE_FILTERS")),this._csvYesNo("inctabledata",this.options.csvOpts.inctabledata,s,o,Joomla.JText._("COM_FABRIK_INCLUDE_DATA")),this._csvYesNo("incraw",this.options.csvOpts.incraw,s,o,Joomla.JText._("COM_FABRIK_INCLUDE_RAW_DATA")),this._csvYesNo("inccalcs",this.options.csvOpts.inccalcs,s,o,Joomla.JText._("COM_FABRIK_INCLUDE_CALCULATIONS"))])),t=Joomla.JText._("COM_FABRIK_SELECT_COLUMNS_TO_EXPORT"),r="opt__"+n.makeSafeForCSS(t),l=(m("<div />").prop("class",r).text(t).appendTo(a),"");return m.each(this.options.labels,function(t,i){var e;"fabrik_"!==t.substr(0,7)&&"____form_heading"!==t&&((e=t.split("___")[0])!==l&&(l=e,r="opt__"+n.makeSafeForCSS(l),m("<div />").prop("class",r).css({clear:"left","font-weight":"600"}).text(l).appendTo(a)),i=i.replace(/<\/?[^>]+(>|jQuery)/g,""),n._csvYesNo("fields["+t+"]",!0,s,o,i).appendTo(a)),0}),0<this.options.formels.length&&(t=Joomla.JText._("COM_FABRIK_FORM_FIELDS"),r="opt__"+n.makeSafeForCSS(t),m("<div />").prop("class",r).text(t).appendTo(a),this.options.formels.each(function(t){n._csvYesNo("fields["+t.name+"]",!1,s,o,t.label).appendTo(a)})),m("<input />").attr({type:"hidden",name:"view",value:"table"}).appendTo(a),m("<input />").attr({type:"hidden",name:"option",value:"com_fabrik"}).appendTo(a),m("<input />").attr({type:"hidden",name:"listid",value:n.id}).appendTo(a),m("<input />").attr({type:"hidden",name:"format",value:"csv"}).appendTo(a),m("<input />").attr({type:"hidden",name:"c",value:"table"}).appendTo(a),a},triggerCSVExport:function(t,e,i){var s=this,o=(0!==t?-1===t?(t=0,(e=s.csvopts).fields=s.csvfields):(e=s.csvopts,i=s.csvfields):(e||(e={},["incfilters","inctabledata","incraw","inccalcs","excel"].each(function(t){var i=s.csvExportForm.find("input[name="+t+"]");0<i.length&&(e[t]=i.filter(function(){return this.checked})[0].value)})),i||(i={},s.csvExportForm.find("input[name^=field]").each(function(){var t;this.checked&&(t=this.name.replace("fields[","").replace("]",""),i[t]=m(this).val())})),e.fields=i,s.csvopts=e,s.csvfields=i),(e=this.csvExportFilterOpts(e)).start=t,e.option="com_fabrik",e.view="list",e.format="csv",e.listid=this.id,e.listref=this.options.listRef,e.download=0,e.setListRefFromRequest=1,"?Itemid="+this.options.Itemid);this.options.csvOpts.custom_qs.split("&").each(function(t){o+="&"+t}),new Request.JSON({url:o,method:"post",data:e,onError:function(t,i){fconsole(t,i)},onComplete:function(t){var i;t.err?(window.alert(t.err),v.Windows.exportcsv.close()):(m("#csvcount").text(t.count),m("#csvtotal").text(t.total),m("#csvfile").text(t.file),t.count<t.total?s.triggerCSVExport(t.count):(i=s.options.admin?v.liveSite+"administrator/index.php?option=com_fabrik&task=list.view&format=csv&listid="+s.id+"&start="+t.count:(i=s.options.csvOpts.exportLink,(i+=i.contains("?")?"&":"?")+"start="+t.count),i+="&"+s.options.csvOpts.custom_qs,t='<div class="alert alert-success" style="padding:10px;margin-bottom:3px"><h3>'+Joomla.JText._("COM_FABRIK_CSV_COMPLETE"),t+='</h3><p><a class="btn btn-success" href="'+i+'"><i class="icon-download"></i> '+Joomla.JText._("COM_FABRIK_CSV_DOWNLOAD_HERE")+"</a></p></div>",m("#csvmsg").html(t),document.getElements("input.exportCSVButton").removeProperty("disabled"),m("#csvmsg a.btn-success").focusout(function(){v.Windows.exportcsv.close(!0)}),s.csvWindow.fitToContent()))}}).send()},csvExportFilterOpts:function(e){var s,o,n,a=0,r=this,l=0,c=["value","condition","join","key","search_type","match","full_words_only","eval","grouped_to_previous","hidden","elementid"];return this.getFilters().each(function(t,i){i=m(i),3<(n=i.prop("name").split("[")).length&&(n=parseInt(n[3].replace("]",""),10),a=a<n?n:a,"checkbox"!==i.prop("type")&&"radio"!==i.prop("type")||i[0].checked)&&(e[i.name]=i.val())}),a++,Object.each(this.options.advancedFilters,function(t,i){if(c.contains(i))for(s=l=0;s<t.length;s++)l=s+a,o="fabrik___filter[list_"+r.options.listRef+"]["+i+"]["+l+"]",e[o]=("value"===i?r.options.advancedFilters.origvalue:"condition"===i?r.options.advancedFilters.orig_condition:t)[s]}),e},addPlugins:function(t){var i=this;t.each(function(t){t.list=i}),this.plugins=t},firePlugin:function(i){var e=Array.prototype.slice.call(arguments),s=this,e=e.slice(1,e.length);return this.plugins.each(function(t){v.fireEvent(i,[s,e])}),!1!==this.result},watchEmpty:function(){var i=this;m(this.form).find(".doempty").on("click",function(t){t.preventDefault(),window.confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DROP"))&&i.submit("list.doempty")})},watchOrder:function(){var r,l,c,p,d=!1,h=m(this.form),f=this,t=h.find(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc");t.off("click"),t.on("click",function(t){var i="",e="",s="",o="",n=m(this),a=n.closest(".fabrik_ordercell");switch((n="A"!==n.prop("tagName")?a.find("a"):n).attr("class")){case"fabrikorder-asc":e="fabrikorder-desc",s=n.data("data-sort-desc-icon"),o=n.data("data-sort-asc-icon"),i="desc",0;break;case"fabrikorder-desc":e="fabrikorder",s=n.data("data-sort-icon"),o=n.data("data-sort-desc-icon"),i="-",0;break;case"fabrikorder":e="fabrikorder-asc",s=n.data("data-sort-asc-icon"),o=n.data("data-sort-icon"),i="asc",0}a.attr("class").split(" ").each(function(t){t.contains("_order")&&(d=t.replace("_order","").replace(/^\s+/g,"").replace(/\s+$/g,""))}),d?(n.attr("class",e),l=v.bootstrapped?n.find("*[data-isicon]"):(r=n.find("img"),n.firstElementChild),f.options.singleOrdering&&h.find(".fabrikorder, .fabrikorder-asc, .fabrikorder-desc").each(function(t){if(v.bootstrapped)switch(c=t.firstElementChild,t.className){case"fabrikorder-asc":c.removeClass(t.data("sort-asc-icon")),c.addClass(t.data("sort-icon"));break;case"fabrikorder-desc":c.removeClass(t.data("sort-desc-icon")),c.addClass(t.data("sort-icon"))}else 0<(r=t.find("img")).length&&(p=(p=r.attr("src")).replace("ordernone.png","").replace("orderasc.png","").replace("orderdesc.png",""),p+="ordernone.png",r.attr("src",p))}),v.bootstrapped?(l.removeClass(o),l.addClass(s)):r&&(p=(p=r.attr("src")).replace("ordernone.png","").replace("orderasc.png","").replace("orderdesc.png",""),r.attr("src",p)),f.fabrikNavOrder(d,i),t.preventDefault()):fconsole("woops didnt find the element id, cant order")})},getFilters:function(){return m(this.form).find(".fabrik_filter")},storeCurrentValue:function(){"submitform"!==this.options.filterMethod&&this.getFilters().each(function(t,i){(i=m(i)).data("initialvalue",i.val())})},watchFilters:function(){var e,s=this,t=m(this.form).find(".fabrik_filter_submit");this.getFilters().each(function(t,i){i=m(i),e="SELECT"===i.prop("tagName")||"checkbox"===i.prop("type")?"change":"blur","submitform"!==s.options.filterMethod&&(i.off(e),i.on(e,function(t){t.preventDefault(),"checkbox"!==i.prop("type")&&i.data("initialvalue")===i.val()||s.doFilter()}))}),t.off(),t.on("click",function(t){t.preventDefault(),s.doFilter()}),this.getFilters().on("keydown",function(t){13===t.keyCode&&(t.preventDefault(),s.doFilter())})},doFilter:function(){var t=v.fireEvent("list.filter",[this]).eventResults;null===t&&this.submit("list.filter"),0!==t.length&&t.contains(!1)||this.submit("list.filter")},setActive:function(t){this.list.getElements(".fabrik_row").each(function(t){t.removeClass("activeRow")}),t.addClass("activeRow")},getActiveRow:function(t){t=m(t.target).closest(".fabrik_row");return t=0===t.length?v.activeRow:t},watchRows:function(){this.list&&this.rowClicks()},getForm:function(){return this.form||(this.form=document.id(this.options.form)),this.form},uncheckAll:function(){m(this.form).find("input[name^=ids]").each(function(t,i){i.checked=""})},submitDeleteCheck:function(){var t,e=!1,s=0;return m(this.form).find("input[name^=ids]").each(function(t,i){i.checked&&(s++,e=!0)}),e?(t=1===s?Joomla.JText._("COM_FABRIK_CONFIRM_DELETE_1"):Joomla.JText._("COM_FABRIK_CONFIRM_DELETE").replace("%s",s),!!window.confirm(t)||(v.loader.stop("listform_"+this.options.listRef),this.uncheckAll(),!1)):(window.alert(Joomla.JText._("COM_FABRIK_SELECT_ROWS_FOR_DELETION")),v.loader.stop("listform_"+this.options.listRef),!1)},submit:function(t){this.getForm();var i=this.options.ajax,e=this,s=m(this.form);if("list.doPlugin.noAJAX"===t&&(i=!(t="list.doPlugin")),"list.delete"!==t||this.submitDeleteCheck())if("list.filter"===t?(v["filter_listform_"+this.options.listRef].onSubmit(),this.form.task.value=t,this.form["limitstart"+this.id]&&s.find("#limitstart"+this.id).val(0)):"list.view"===t?v["filter_listform_"+this.options.listRef].onSubmit():""!==t&&(this.form.task.value=t),i){v.loader.start("listform_"+this.options.listRef),s.find("input[name=option]").val("com_fabrik"),s.find("input[name=view]").val("list"),s.find("input[name=format]").val("raw");var o=(o=(o=this.form.toQueryString())+"&setListRefFromRequest=1"+("&listref="+this.options.listRef))+("&Itemid="+this.options.Itemid);"list.filter"===t&&!1!==this.advancedSearch&&(i=document.getElement("form.advancedSearch_"+this.options.listRef),"null"!==typeOf(i))&&(o=o+("&"+i.toQueryString())+"&replacefilters=1");for(var n=0;n<this.options.fabrik_show_in_list.length;n++)o+="&fabrik_show_in_list[]="+this.options.fabrik_show_in_list[n];o+="&tmpl="+this.options.tmpl,this.request?this.request.options.data=o:this.request=new Request({url:this.form.get("action"),data:o,onComplete:function(t){t=JSON.parse(t),e._updateRows(t),v.loader.stop("listform_"+e.options.listRef),v["filter_listform_"+e.options.listRef].onUpdateData(),v["filter_listform_"+e.options.listRef].updateFilterCSS(t),m("#searchall_"+e.options.listRef).val(t.searchallvalue),v.fireEvent("fabrik.list.submit.ajax.complete",[e,t]),t.msg&&t.showmsg&&window.alert(t.msg)}}),this.request.send(),window.history&&window.history.pushState&&history.pushState(o,"fabrik.list.submit"),v.fireEvent("fabrik.list.submit",[t,this.form.toQueryString().toObject()])}else this.form.submit();return!1},fabrikNav:function(t){return this.options.limitStart=t,this.form.getElement("#limitstart"+this.id).value=t,v.fireEvent("fabrik.list.navigate",[this,t]),this.result?(this.submit("list.view"),!1):!(this.result=!0)},getRowIds:function(){var i=[];return(this.options.isGrouped?$H(this.options.data):this.options.data).each(function(t){t.each(function(t){i.push(t.data.__pk_val)})}),i},getCheckedRowIds:function(){return this.getForm().getElements("input[name^=ids]").filter(function(t){return t.checked}).map(function(t){return t.get("value")})},getRow:function(s){var o={};return Object.each(this.options.data,function(t){for(var i=0;i<t.length;i++){var e=t[i];e&&e.data.__pk_val==s&&(o=e.data)}}),o},fabrikNavOrder:function(t,i){if(this.form.orderby.value=t,this.form.orderdir.value=i,v.fireEvent("fabrik.list.order",[this,t,i]),!this.result)return!(this.result=!0);this.submit("list.order")},removeRows:function(t){function i(){o.dispose(),e.checkEmpty()}for(var e=this,s=0;s<t.length;s++){var o=document.id("list_"+e.id+"_row_"+t[s]);new Fx.Morph(o,{duration:1e3}).start({backgroundColor:this.options.hightLight}).chain(function(){this.start({opacity:0})}).chain(i)}},editRow:function(){},clearRows:function(){this.list.getElements(".fabrik_row").each(function(t){t.dispose()})},updateRows:function(t){var i=this,e={option:"com_fabrik",view:"list",task:"list.view",format:"raw",listid:this.id,listref:this.options.listRef};e["limit"+this.id]=this.options.limitLength,t&&Object.append(e,t),""!==this.options.groupedBy&&(e.group_by=this.options.groupedBy),new Request({url:"",data:e,evalScripts:!1,onSuccess:function(t){t=t.stripScripts(),t=JSON.parse(t),i._updateRows(t)},onError:function(t,i){fconsole(t,i)},onFailure:function(t){fconsole(t)}}).send()},_updateHeadings:function(t){var e=m("#"+this.options.form).find(".fabrik___heading");m.each(t.headings,function(t,i){t="."+t;try{e.find(t+" span").html(i)}catch(t){fconsole(t)}})},_updateGroupByTables:function(){var e,t=m(this.list).find("tbody");t.css("display",""),t.each(function(t,i){i.hasClass("fabrik_groupdata")||(e=m(i).next(),0===m(e).find(".fabrik_row").length&&(m(i).hide(),m(e).hide()))})},_updateRows:function(t){var s,o,n,a,r,l,i,c,e,p,d=[],h=m(this.form),f=this,u="tr";"object"===typeOf(t)&&(window.history&&window.history.pushState&&history.pushState(t,"fabrik.list.rows"),t.id==this.id)&&"list"===t.model&&(this._updateHeadings(t),this.setItemTemplate(),0===(i=m(this.list).find(".fabrik_row").first()).length&&(i=m(this.options.itemTemplate)),u="TR"===i.prop("tagName")?(e=i,a=1,"tr"):(e=i.parent(),a=h.find(".fabrikDataContainer").data("cols"),"div"),a=void 0===a?1:a,l=this.setRowTemplate(e),o=i.clone(),this.clearRows(),this.options.data=this.options.isGrouped?$H(t.data):t.data,t.calculations&&this.updateCals(t.calculations),h.find(".fabrikNav").html(t.htmlnav),e=this.options.isGrouped||""!==this.options.groupedBy?$H(t.data):t.data,p=0,e.each(function(t,i){for(s=f.options.isGrouped?f.list.getElements(".fabrik_groupdata")[p]:f.tbody,(s=m(s)).children().not(".groupDataMsg").remove(),f.options.isGrouped&&s.prev().find(".groupTitle").html(t[0].groupHeading),d=[],p++,n=0;n<t.length;n++){var e=$H(t[n]);r=f.injectItemData(o,e,u),d.push(r)}for(d=v.Array.chunk(d,a),n=0;n<d.length;n++)c="div"===u?(c=d[n],l.clone().append(c)):d[n],s.append(c)}),this._updateGroupByTables(),this._updateEmptyDataMsg(0===d.length),this.watchAll(!0),v.fireEvent("fabrik.list.updaterows"),v.fireEvent("fabrik.list.update",[this,t]),this.stripe(),this.mediaScan(),v.loader.stop("listform_"+this.options.listRef))},_updateEmptyDataMsg:function(t){var i=m(this.list),e=i.parent(".fabrikDataContainer"),i=i.closest(".fabrikForm").find(".emptyDataMessage");t?(i.css("display",""),"none"===i.parent().css("display")&&i.parent().css("display",""),i.parent(".emptyDataMessage").css("display","")):(e.css("display",""),i.css("display","none"))},injectItemData:function(o,t,i){var e,n,s;if(m.each(t.data,function(t,i){if("A"!==(n=o.find("."+t)).prop("tagName"))n.html(i);else try{var e=m(i).prop("href"),s=m(i).data("rowid");m.each(n,function(t,i){0===m(i).data("iscustom")&&(m(i).prop("href",e),m(i).data("rowid",s))})}catch(t){n.prop("href",i)}}),"string"==typeof this.options.itemTemplate){if((s=o.find(".fabrik_row").addBack(o)).prop("id",t.id),"div"!==i){s.removeClass();for(var a=t.class.split(/\s+/),r=0;r<a.length;r++)s.addClass(a[r])}else{s.removeClass("oddRow0"),s.removeClass("oddRow1");a=t.class.split(/\s+/);for(r=0;r<a.length;r++)s.hasClass(a[r])||s.addClass(a[r])}e=o.clone()}else e=o.find(".fabrik_row").addBack(o);return e},mediaScan:function(){"undefined"!=typeof Slimbox&&Slimbox.scanPage(),"undefined"!=typeof Lightbox&&Lightbox.init(),"undefined"!=typeof Mediabox&&Mediabox.scanPage()},addRow:function(t){var i,e,s=new Element("tr",{class:"oddRow1"});for(i in t)-1!==this.options.headings.indexOf(i)&&(e=new Element("td",{}).appendText(t[i]),s.appendChild(e));s.inject(this.tbody)},addRows:function(t){for(var i,e=0;e<t.length;e++)for(i=0;i<t[e].length;i++)this.addRow(t[e][i]);this.stripe()},stripe:function(){for(var t=this.list.getElements(".fabrik_row"),i=0;i<t.length;i++)t[i].hasClass("fabrik___header")||t[i].addClass("oddRow"+i%2)},checkEmpty:function(){2===this.list.getElements("tr").length&&this.addRow({label:Joomla.JText._("COM_FABRIK_NO_RECORDS")})},watchCheckAll:function(){var i,e,s,o,t=m(this.form),n=t.find("input[name=checkAll]"),a=this,r=m(this.list);n.on("click",function(t){for(s=0<r.closest(".fabrikList").length?r.closest(".fabrikList"):r,o=s.find("input[name^=ids]"),i=t.target.checked?"checked":"",e=0;e<o.length;e++)o[e].checked=i,a.toggleJoinKeysChx(o[e])}),t.find("input[name^=ids]").each(function(t,i){m(i).on("change",function(){a.toggleJoinKeysChx(i)})})},toggleJoinKeysChx:function(i){i.getParent().getElements("input[class=fabrik_joinedkey]").each(function(t){t.checked=i.checked})},watchNav:function(t){var i,e,s=m(this.form),o=s.find("select[name*=limit]"),n=s.find(".addRecord"),a=this,o=(o.on("change",function(){if(v.fireEvent("fabrik.list.limit",[a]),!1===a.result)return!(a.result=!0);a.doFilter()}),this.options.ajax_links&&0<n.length&&(n.off(),o=n.prop("href"),i=""===this.options.links.add||o.contains(v.liveSite)?"xhr":"iframe",e=(e=o)+(e.contains("?")?"&":"?")+"tmpl=component&ajax=1&format=partial",n.on("click",function(t){t.preventDefault();t={id:"add."+a.id,title:a.options.popup_add_label,loadMethod:i,contentURL:e,width:a.options.popup_width,height:a.options.popup_height};null!==a.options.popup_offset_x&&(t.offset_x=a.options.popup_offset_x),null!==a.options.popup_offset_y&&(t.offset_y=a.options.popup_offset_y),v.getWindow(t)})),m("#fabrik__swaptable").on("change",function(){window.location="index.php?option=com_fabrik&task=list.view&cid="+this.value}),s.find(".pagination .pagenav"));0===o.length&&(o=s.find(".pagination a")),m(o).on("click",function(t){t.preventDefault(),"A"===this.tagName&&(t=this.href.toObject(),a.fabrikNav(t["limitstart"+a.id]))}),this.watchCheckAll()},updateCals:function(i){var t=["sums","avgs","count","medians"];this.form.getElements(".fabrik_calculations").each(function(e){t.each(function(t){$H(i[t]).each(function(t,i){i=e.getElement("."+i);"null"!==typeOf(i)&&i.set("html",t)})})})}})});
//# sourceMappingURL=list.js.map