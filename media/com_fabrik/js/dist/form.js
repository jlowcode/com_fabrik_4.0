/*! Fabrik */

define(["jquery","fab/encoder","fab/fabrik","lib/debounce/jquery.ba-throttle-debounce"],(function(t,e,i,o){var r=new Class({Implements:[Options,Events],options:{rowid:"",admin:!1,ajax:!1,primaryKey:null,error:"",submitOnEnter:!1,updatedMsg:"Form saved",pages:[],start_page:0,multipage_save:0,ajaxValidation:!1,showLoader:!1,customJsAction:"",plugins:{},ajaxmethod:"post",inlineMessage:!0,print:!1,toggleSubmit:!1,toggleSubmitTip:"must validate",mustValidate:!1,lang:!1,debounceDelay:500,images:{alert:"",action_check:"",ajax_loader:""}},initialize:function(t,e){"null"===typeOf(e.rowid)&&(e.rowid=""),this.id=t,this.result=!0,this.setOptions(e),this.options.pages=$H(this.options.pages),this.subGroups=$H({}),this.currentPage=this.options.start_page,this.formElements=$H({}),this.hasErrors=$H({}),this.mustValidateEls=$H({}),this.toggleSubmitTipAdded=!1,this.elements=this.formElements,this.duplicatedGroups=$H({}),this.addingOrDeletingGroup=!1,this.addedGroups=[],this.watchRepeatNumsDone=!1,this.fx={},this.fx.elements=[],this.fx.hidden=[],this.fx.validations={},this.setUpAll(),this._setMozBoxWidths(),this.options.editable&&function(){this.duplicateGroupsToMin()}.bind(this).delay(1e3),this.events={},this.submitBroker=new FbFormSubmit,this.scrollTips(),i.fireEvent("fabrik.form.loaded",[this])},_setMozBoxWidths:function(){Browser.firefox&&this.getForm()&&this.getForm().getElements(".fabrikElementContainer > .displayBox").each((function(t){var e=t.getParent().getComputedSize(),i=t.getParent().getSize().x-(e.computedLeft+e.computedRight),o=0===t.getParent().getSize().x?400:i;t.setStyle("width",o+"px");var r=t.getElement(".fabrikElement");"null"!==typeOf(r)&&(i=0,t.getChildren().each((function(t){t!==r&&(i+=t.getSize().x)})),r.setStyle("width",o-i-10+"px"))}))},setUpAll:function(){if(this.setUp(),this.options.ajaxValidation&&this.options.toggleSubmit&&""!==this.options.toggleSubmitTip){var e=this._getButton("Submit");"null"!==typeOf(e)&&t(e).wrap('<div data-bs-toggle="tooltip" title="'+Joomla.JText._("COM_FABRIK_MUST_VALIDATE")+'" class="fabrikSubmitWrapper" style="display: inline-block"></div>div>')}this.winScroller=new Fx.Scroll(window),this.form&&((this.options.ajax||!1===this.options.submitOnEnter)&&this.stopEnterSubmitting(),this.watchAddOptions()),this.options.editable&&($H(this.options.hiddenGroup).each(function(t,e){if(!0===t&&"null"!==typeOf(document.id("group"+e))){var i=document.id("group"+e).getElement(".fabrikSubGroup");this.subGroups.set(e,i.cloneWithIds()),this.hideLastGroup(e,i)}}.bind(this)),this.setupSortable()),this.repeatGroupMarkers=$H({}),this.form&&(this.form.getElements(".fabrikGroup").each(function(t){var e=t.id.replace("group",""),i=t.getElements(".fabrikSubGroup").length;1===i&&"none"===t.getElement(".fabrikSubGroupElements").getStyle("display")&&(i=0),this.repeatGroupMarkers.set(e,i)}.bind(this)),this.watchGoBackButton()),this.watchPrintButton(),this.watchPdfButton(),this.watchTabs(),this.watchRepeatNums()},watchRepeatNums:function(){i.addEvent("fabrik.form.elements.added",function(t){t.id!==this.id||this.watchRepeatNumsDone||(Object.each(this.options.numRepeatEls,function(t,e){if(""!==t){var i=this.formElements.get(t);i&&i.addNewEventAux(i.getChangeEvent(),function(t){var o=i.getValue();this.options.minRepeat[e]=o.toInt(),this.options.maxRepeat[e]=o.toInt(),this.duplicateGroupsToMin()}.bind(this,i,e))}}.bind(t)),this.watchRepeatNumsDone=!0)}.bind(this))},watchPrintButton:function(){this.form&&this.form.getElements("a[data-fabrik-print]").addEvent("click",function(e){if(e.stop(),this.options.print)window.print();else{var i=t(e.target).prop("href");i=i.replace(/&rowid=\d+/,"&rowid="+this.options.rowid),!1!==this.options.lang&&(i.test(/\?/)?i+="&lang="+this.options.lang:i+="?lang="+this.options.lang),window.open(i,"win2","status=no,toolbar=no,scrollbars=yes,titlebar=no,menubar=no,resizable=yes,width=400,height=350,directories=no,location=no;")}}.bind(this))},watchPdfButton:function(){this.form&&this.form.getElements('*[data-role="open-form-pdf"]').addEvent("click",function(t){t.stop();var e=t.event.currentTarget.href.replace(/(rowid=\d*)/,"rowid="+this.options.rowid);!1!==this.options.lang&&(e.test(/\?/)?e+="&lang="+this.options.lang:e+="?lang="+this.options.lang),window.location=e}.bind(this))},watchGoBackButton:function(){if(this.options.ajax){var t=this._getButton("Goback");if("null"===typeOf(t))return;t.addEvent("click",function(t){t.stop(),i.Windows[this.options.fabrik_window_id]?i.Windows[this.options.fabrik_window_id].close():window.history.back()}.bind(this))}},watchAddOptions:function(){this.fx.addOptions=[],this.getForm().getElements(".addoption").each((function(t){var e=t.getParent(".fabrikElementContainer").getElement(".toggle-addoption"),i=new Fx.Slide(t,{duration:500});i.hide(),e.addEvent("click",(function(t){t.stop(),i.toggle()}))}))},setUp:function(){this.form=this.getForm(),this.watchGroupButtons(),this.watchSubmit(),this.createPages(),this.watchClearSession()},getForm:function(){return"null"===typeOf(this.form)&&(this.form=document.id(this.getBlock())),this.form},getBlock:function(){return"null"===typeOf(this.block)&&(this.block=!0===this.options.editable?"form_"+this.id:"details_"+this.id,""!==this.options.rowid&&(this.block+="_"+this.options.rowid)),this.block},addElementFX:function(t,e){var i,o,r;if("group_"===(t=t.replace("fabrik_trigger_","")).slice(0,6)){if(o=t=t.slice(6,t.length),!(i=document.id(t)))return fconsole('Fabrik form::addElementFX: Group "'+t+'" does not exist.'),!1}else{if("element_"!==t.slice(0,8))return fconsole("Fabrik form::addElementFX: Not an element or group: "+t),!1;if(o="element"+(t=t.slice(8,t.length)),!(i=document.id(t)))return fconsole('Fabrik form::addElementFX: Element "'+t+'" does not exist.'),!1;if(!(i=i.getParent(".fabrikElementContainer")))return fconsole('Fabrik form::addElementFX: Element "'+t+'.fabrikElementContainer" does not exist.'),!1}if(i){var n=i.get("tag");"li"===n||"td"===n?(r=new Element("div",{style:"width:100%"}).adopt(i.getChildren()),i.empty(),r.inject(i)):r=i;var s={duration:800,transition:Fx.Transitions.Sine.easeInOut};return"null"===typeOf(this.fx.elements[o])&&(this.fx.elements[o]={}),this.fx.elements[o].css=new Fx.Morph(r,s),"null"===typeOf(r)||"slide in"!==e&&"slide out"!==e&&"slide toggle"!==e||(this.fx.elements[o].slide=new Fx.Slide(r,s)),this.fx.elements[o]}return!1},doElementFX:function(e,o,r){var n,s,a,l,u=this.formElements.get(e.replace("fabrik_trigger_element_","")),p=!0;if(u&&(p=u.options.inRepeatGroup),s="fabrik_trigger_group_"===e.slice(0,21),r&&p&&!s&&r.options.inRepeatGroup){var d=e.split("_");d[d.length-1]=r.options.repeatCounter,e=d.join("_")}if("group_"===(e=e.replace("fabrik_trigger_","")).slice(0,6)?("group_"===(e=e.slice(6,e.length)).slice(0,6)&&(e=e.slice(6,e.length)),n=e):n="element"+(e=e.slice(8,e.length)),(a=this.fx.elements[n])||(a=this.addElementFX("element_"+e,o))){switch("td"===(l=s||a.css.element.hasClass("fabrikElementContainer")?a.css.element:a.css.element.getParent(".fabrikElementContainer")).get("tag")&&(l=l.getChildren()[0]),o){case"show":l.fade("show").removeClass("fabrikHide"),s&&(document.id(e).getElements(".fabrikinput").setStyle("opacity","1"),this.showGroupTab(e),l.show());break;case"hide":l.fade("hide").addClass("fabrikHide"),s&&this.hideGroupTab(e);break;case"fadein":l.removeClass("fabrikHide"),"fadein"!==a.css.lastMethod&&(a.css.element.show(),a.css.start({opacity:[0,1]})),s&&(this.showGroupTab(e),l.show());break;case"fadeout":"fadeout"!==a.css.lastMethod&&a.css.start({opacity:[1,0]}).chain((function(){a.css.element.hide(),l.addClass("fabrikHide")})),s&&this.hideGroupTab(e);break;case"slide in":a.slide.slideIn();break;case"slide out":a.slide.slideOut(),l.removeClass("fabrikHide");break;case"slide toggle":a.slide.toggle();break;case"clear":this.formElements.get(e).clear();break;case"disable":s||t("#"+e).prop("disabled",!0);break;case"enable":s||t("#"+e).prop("disabled",!1);break;case"readonly":s||("SELECT"===t("#"+e).prop("tagName")?t("#"+e+" option:not(:selected)").attr("disabled",!0):t("#"+e).prop("readonly",!0));break;case"notreadonly":s||("SELECT"===t("#"+e).prop("tagName")?t("#"+e+" option").attr("disabled",!1):t("#"+e).prop("readonly",!1))}a.lastMethod=o,i.fireEvent("fabrik.form.doelementfx",[this,o,e,s])}},getGroupTab:function(t){t.test(/^group/)||(t="group"+t);var e=document.getElementById(t+"_tab");return null!=e&&e},hideGroupTab:function(e){var i=this.getGroupTab(e);!1!==i&&(t(i).hide(),i.hasClass("active")&&(i.getPrevious()?t(i.getPrevious().getFirst()).tab("show"):i.getNext()&&t(i.getNext().getFirst()).tab("show")))},selectGroupTab:function(e){var i=this.getGroupTab(e);!1!==i&&(i.hasClass("active")||t(i.getFirst()).tab("show"))},showGroupTab:function(e){var i=this.getGroupTab(e);!1!==i&&t(i).show()},watchTabs:function(){var e=this;t(this.form).on("click","*[data-role=fabrik_tab]",(function(t){var o=t.target.id.match(/group(\d+)_tab/);o.length>1&&(o=o[1]),i.fireEvent("fabrik.form.tab.click",[e,o,t],500)}))},watchClearSession:function(){if(0!==this.options.multipage_save){var e=this,i=t(this.form);i.find(".clearSession").on("click",(function(t){t.preventDefault(),i.find("input[name=task]").val("removeSession"),e.clearForm(),e.form.submit()}))}},createPages:function(){var e,i,o;if(this.isMultiPage()){this.options.pages.each((function(e,r){(i=t(document.createElement("div"))).attr({class:"page",id:"page_"+r}),o=t("#group"+e[0]),o.closest("div").hasClass("tab-pane")||(i.insertBefore(o),e.each((function(e){i.append(t("#group"+e))})))})),(e=this._getButton("Submit"))&&""===this.options.rowid&&(e.disabled="disabled",e.setStyle("opacity",.5));var r=this;t(this.form).on("click",".fabrikPagePrevious",(function(t){r._doPageNav(t,-1)})),t(this.form).on("click",".fabrikPageNext",(function(t){r._doPageNav(t,1)})),this.setPageButtons(),this.hideOtherPages()}},isMultiPage:function(){return this.options.pages.getKeys().length>1},_doPageNav:function(e,o){var r,n,s=this;this.options.editable?("null"!==typeOf(this.form.getElement(".fabrikMainError"))&&this.form.getElement(".fabrikMainError").addClass("fabrikHide"),t(".tool-tip").css("top",0),r="index.php?option=com_fabrik&format=raw&task=form.ajax_validate&form_id="+this.id,!1!==this.options.lang&&(r+="&lang="+this.options.lang),i.loader.start(this.getBlock(),Joomla.JText._("COM_FABRIK_VALIDATING")),this.clearErrors(),n=t.extend({},this.getFormData(),{task:"form.ajax_validate",fabrik_ajax:"1",format:"raw"}),n=this._prepareRepeatsForAjax(n),t.ajax({url:r,method:this.options.ajaxmethod,data:n}).done((function(e){i.loader.stop(s.getBlock()),e=JSON.parse(e),-1!==o&&!1!==s._showGroupError(e,n)||(s.changePage(o),s.saveGroupsToDb()),t("html, body").animate({scrollTop:t(s.form).offset().top},300)}))):this.changePage(o),e.preventDefault()},saveGroupsToDb:function(){var e,o,r,n,s=this,a=this.form.querySelector("input[name=format]"),l=this.form.querySelector("input[name=task]"),u=this.getBlock();0!==this.options.multipage_save&&(i.fireEvent("fabrik.form.groups.save.start",[this]),!1!==this.result?(e=a.value,o=l.value,this.form.querySelector("input[name=format]").value="raw",this.form.querySelector("input[name=task]").value="form.savepage",r="index.php?option=com_fabrik&format=raw&page="+this.currentPage,!1!==this.options.lang&&(r+="&lang="+this.options.lang),i.loader.start(u,"saving page"),(n=this.getFormData()).fabrik_ajax=1,t.ajax({url:r,method:this.options.ajaxmethod,data:n}).done((function(t){i.fireEvent("fabrik.form.groups.save.completed",[s]),!1!==s.result?(a.value=e,l.value=o,s.options.ajax&&i.fireEvent("fabrik.form.groups.save.end",[s,t]),i.loader.stop(u)):s.result=!0}))):this.result=!0)},changePage:function(e){this.changePageDir=e,i.fireEvent("fabrik.form.page.change",[this,e]),!1!==this.result?(this.currentPage=this.currentPage.toInt(),this.currentPage+e>=0&&this.currentPage+e<this.options.pages.getKeys().length&&(this.currentPage=this.currentPage+e,this.pageGroupsVisible()||this.changePage(e)),this.setPageButtons(),t("#page_"+this.currentPage).css("display",""),this._setMozBoxWidths(),this.hideOtherPages(),i.fireEvent("fabrik.form.page.chage.end",[this,e]),i.fireEvent("fabrik.form.page.change.end",[this,e]),!1!==this.result||(this.result=!0)):this.result=!0},pageGroupsVisible:function(){var e=!1;return this.options.pages.get(this.currentPage).each((function(i){var o=t("#group"+i);o.length>0&&"none"!==o.css("display")&&(e=!0)})),e},hideOtherPages:function(){var e=parseInt(this.currentPage,10);this.options.pages.each((function(i,o){parseInt(o,10)!==e&&t("#page_"+o).hide()}))},setPageButtons:function(){var t=this._getButton("Submit"),e=this.form.getElements(".fabrikPagePrevious");this.form.getElements(".fabrikPageNext").each(function(e){this.currentPage===this.options.pages.getKeys().length-1?("null"!==typeOf(t)&&(t.disabled="",t.setStyle("opacity",1)),e.disabled="disabled",e.setStyle("opacity",.5)):("null"===typeOf(t)||""!==this.options.rowid&&"0"!==this.options.rowid.toString()||(t.disabled="disabled",t.setStyle("opacity",.5)),e.disabled="",e.setStyle("opacity",1))}.bind(this)),e.each(function(t){0===this.currentPage?(t.disabled="disabled",t.setStyle("opacity",.5)):(t.disabled="",t.setStyle("opacity",1))}.bind(this))},destroyElements:function(){this.formElements.each((function(t){t.destroy()}))},addElements:function(t){var e=[],o=0;for((t=$H(t)).each(function(t,i){t.each(function(t){if("array"===typeOf(t)){if("null"===typeOf(document.id(t[1])))return void(void 0!==document.getElements("input[name=rowid]")[0]&&""!=document.getElements("input[name=rowid]")[0].value&&"FbLockrow"!=t[0]&&fconsole('Fabrik form::addElements: Cannot add element "'+t[1]+'" because it does not exist in HTML.'));try{var o=new window[t[0]](t[1],t[2])}catch(e){return void fconsole('Fabrik form::addElements: Cannot add element "'+t[1]+'" of type "'+t[0]+'" because: '+e.message)}e.push(this.addElement(o,t[1],i))}else if("object"===typeOf(t)){if("null"===typeOf(document.id(t.options.element)))return void fconsole('Fabrik form::addElements: Cannot add element "'+t.options.element+'" because it does not exist in HTML.');e.push(this.addElement(t,t.options.element,i))}else"null"!==typeOf(t)?fconsole("Fabrik form::addElements: Cannot add unknown element: "+t):fconsole("Fabrik form::addElements: Cannot add null element.")}.bind(this))}.bind(this)),o=0;o<e.length;o++)if("null"!==typeOf(e[o]))try{e[o].attachedToForm()}catch(t){fconsole(e[o].options.element+" attach to form:"+t)}i.fireEvent("fabrik.form.elements.added",[this])},addElement:function(t,e,o){var r="_ro"===(e=(e=t.getFormElementsKey(e)).replace("[]","")).substring(e.length-3,e.length);return t.form=this,t.groupid=o,this.formElements.set(e,t),i.fireEvent("fabrik.form.element.added",[this,e,t]),r&&(e=e.substr(0,e.length-3),this.formElements.set(e,t)),this.submitBroker.addElement(e,t),t},dispatchEvent:function(t,o,r,n){"string"===typeOf(n)&&(n=e.htmlDecode(n));var s=this.formElements.get(o);if(!s)Object.each(this.formElements,(function(t){o===t.baseElementId&&(s=t)}));s?""!==n?s.addNewEvent(r,n):i.debug&&fconsole("Fabrik form::dispatchEvent: Javascript empty for "+r+" event on: "+o):fconsole("Fabrik form::dispatchEvent: Cannot find element to add "+r+" event to: "+o)},action:function(t,e){this.formElements.get(e);Browser.exec("oEl."+t+"()")},triggerEvents:function(t){this.formElements.get(t).fireEvents(arguments[1])},watchValidation:function(e,i){var o=t("#"+e);!1!==this.options.ajaxValidation&&(0!==o.length?(o=this.formElements.get(e)).addAjaxValidation():fconsole("Fabrik form::watchValidation: Could not add "+i+' event because element "'+e+'" does not exist.'))},doElementValidation:function(t,e,o){var r;if(!1!==this.options.ajaxValidation&&(o="null"===typeOf(o)?"_time":o,"event"===typeOf(t)||"object"===typeOf(t)||"domevent"===typeOf(t)?(r=t.target.id,!0===e&&(r=document.id(t.target).getParent(".fabrikSubElementContainer").id)):r=t,"null"!==typeOf(document.id(r)))){!0===document.id(r).getProperty("readonly")||document.id(r).getProperty("readonly");var n=this.formElements.get(r);if((n||(r=r.replace(o,""),n=this.formElements.get(r)))&&n.shouldAjaxValidate())if(i.fireEvent("fabrik.form.element.validation.start",[this,n,t]),!1!==this.result){n.setErrorMessage(Joomla.JText._("COM_FABRIK_VALIDATING"),"fabrikValidating");var s=$H(this.getFormData());s.set("task","form.ajax_validate"),s.set("fabrik_ajax","1"),s.set("format","raw"),!1!==this.options.lang&&s.set("lang",this.options.lang),s=this._prepareRepeatsForAjax(s);var a=r;n.origId&&(a=n.origId+"_0"),n.options.repeatCounter=n.options.repeatCounter?n.options.repeatCounter:0;new Request({url:"",method:this.options.ajaxmethod,data:s,onComplete:function(t){this._completeValidaton(t,r,a)}.bind(this)}).send();localStorage.setItem("popUpForm",JSON.stringify(this.getFormData()))}else this.result=!0}},_completeValidaton:function(t,e,o){if(t=JSON.parse(t),"null"===typeOf(t))return this._showElementError(["Oups"],e),void(this.result=!0);if(this.formElements.each((function(t,e){t.afterAjaxValidation()})),i.fireEvent("fabrik.form.element.validation.complete",[this,t,e,o]),!1!==this.result){var r=this.formElements.get(e);"null"!==typeOf(t.modified[o])&&(r.options.inRepeatGroup?r.update(t.modified[o][r.options.repeatCounter]):r.update(t.modified[o])),"null"!==typeOf(t.errors[o])?this._showElementError(t.errors[o][r.options.repeatCounter],e):this._showElementError([],e),this.options.toggleSubmit&&(this.options.mustValidate?(this.hasErrors.has(e)&&this.hasErrors.get(e)||(this.mustValidateEls[e]=!1),this.mustValidateEls.hasValue(!0)||this.toggleSubmit(!0)):this.toggleSubmit(0===this.hasErrors.getKeys().length))}else this.result=!0},_prepareRepeatsForAjax:function(t){return this.getForm(),"hash"===typeOf(t)&&(t=t.getClean()),this.form.getElements("input[name^=fabrik_repeat_group]").each((function(e){if(e.id.test(/fabrik_repeat_group_\d+_counter/)){var i=e.name.match(/\[(.*)\]/)[1];t["fabrik_repeat_group["+i+"]"]=e.get("value")}})),t},_showGroupError:function(t,e){var i,o=Array.mfrom(this.options.pages.get(this.currentPage.toInt())),r=!1;return $H(e).each(function(e,n){if(n=n.replace(/\[(.*)\]/,"").replace(/%5B(.*)%5D/,""),this.formElements.has(n)){var s=this.formElements.get(n);if(o.contains(s.groupid.toInt())){if(t.errors[n])if(s.options.inRepeatGroup)t.errors[n].each(function(t,e){var o=n.replace(/_(\d+)$/,"_"+e),s=this.formElements.get(o),a="";"null"!==typeOf(t)&&(a=t.flatten().join("<br />")),""!==a?(i=this._showElementError(t,o),!1===r&&(r=i)):s.setErrorMessage("","")}.bind(this));else{var a="";"null"!==typeOf(t.errors[n])&&(a=t.errors[n].flatten().join("<br />")),""!==a?(i=this._showElementError(t.errors[n],n),!1===r&&(r=i)):s.setErrorMessage("","")}t.modified[n]&&s&&s.update(t.modified[n])}}}.bind(this)),r},_showElementError:function(t,e){var i="";"null"!==typeOf(t)&&(i=t.flatten().join("<br />"));var o=""===i?"fabrikSuccess":"fabrikError";return""===i?(delete this.hasErrors[e],i=Joomla.JText._("COM_FABRIK_SUCCESS")):this.hasErrors.set(e,!0),i="<span> "+i+"</span>",this.formElements.get(e).setErrorMessage(i,o),"fabrikSuccess"!==o},updateMainError:function(){var t;"null"!==typeOf(this.form.getElement(".fabrikMainError"))&&this.form.getElement(".fabrikMainError").set("html",this.options.error),(t=this.form.getElements(".fabrikError").filter((function(t,e){return!t.hasClass("fabrikMainError")}))).length>0&&this.form.getElement(".fabrikMainError").hasClass("fabrikHide")&&this.showMainError(this.options.error),0===t.length&&this.hideMainError()},hideMainError:function(){if("null"!==typeOf(this.form.getElement(".fabrikMainError"))){var t=this.form.getElement(".fabrikMainError");myfx=new Fx.Tween(t,{property:"opacity",duration:500,onComplete:function(){t.addClass("fabrikHide")}}).start(1,0)}},showMainError:function(t){if(!(i.bootstrapped&&this.options.ajaxValidation||"null"===typeOf(this.form.getElement(".fabrikMainError")))){var e=this.form.getElement(".fabrikMainError");e.set("html",t),e.removeClass("fabrikHide"),myfx=new Fx.Tween(e,{property:"opacity",duration:500}).start(0,1)}},_getButton:function(t){if(this.getForm()){var e=this.form.getElement("input[type=button][name="+t+"]");return e||(e=this.form.getElement("input[type=submit][name="+t+"]")),e||(e=this.form.getElement("button[type=button][name="+t+"]")),e||(e=this.form.getElement("button[type=submit][name="+t+"]")),e}},watchSubmit:function(){var t=this._getButton("Submit"),e=this._getButton("apply");if(!t&&!e){if(!this.form||!this.form.getElement("button[type=submit]"))return;t=this.form.getElement("button[type=submit]")}var o=this._getButton("delete"),r=this._getButton("Copy");o&&o.addEvent("click",function(t){if(!window.confirm(Joomla.JText._("COM_FABRIK_CONFIRM_DELETE_1")))return!1;var e=i.fireEvent("fabrik.form.delete",[this,this.options.rowid]).eventResults;if("null"!==typeOf(e)&&0!==e.length&&e.contains(!1))return t.stop(),!1;this.form.getElement("input[name=task]").value="form.delete",this.doSubmit(t,o)}.bind(this)),this.form.getElements("button[type=submit]").combine([e,t,r]).each(function(t){"null"!==typeOf(t)&&t.addEvent("click",function(e){this.doSubmit(e,t)}.bind(this))}.bind(this)),this.form.addEvent("submit",function(t){this.doSubmit(t)}.bind(this))},mockSubmit:function(t){t=void 0!==t?t:"Submit";var e=this._getButton(t);e||(e=new Element("button",{name:t,type:"submit"})),this.doSubmit(new Event.Mock(e,"click"),e)},doSubmit:function(e,o){if(this.submitBroker.enabled())return e.stop(),!1;this.toggleSubmit(!1),this.submitBroker.submit(function(){if(this.options.showLoader&&i.loader.start(this.getBlock(),Joomla.JText._("COM_FABRIK_LOADING")),i.fireEvent("fabrik.form.submit.start",[this,e,o]),!1===this.result)return this.result=!0,e.stop(),i.loader.stop(this.getBlock()),this.updateMainError(),void this.toggleSubmit(!0);if(this.options.pages.getKeys().length>1&&this.form.adopt(new Element("input",{name:"currentPage",value:this.currentPage.toInt(),type:"hidden"})),hiddenElements=[],t.each(this.formElements,(function(e,i){i.element&&0!==t(i.element).closest(".fabrikHide").length&&hiddenElements.push(e)})),this.form.adopt(new Element("input",{name:"hiddenElements",value:JSON.stringify(hiddenElements),type:"hidden"})),this.options.ajax&&this.form){this.options.showLoader||i.loader.start(this.getBlock(),Joomla.JText._("COM_FABRIK_LOADING"));var r=$H(this.getFormData());(r=this._prepareRepeatsForAjax(r))[o.name]=o.value,"Copy"===o.name&&(r.Copy=1,e.stop()),r.fabrik_ajax="1",r.format="raw",localStorage.setItem("popUpForm",JSON.stringify(this.getFormData()));new Request.JSON({url:this.form.action,data:r,method:this.options.ajaxmethod,onError:function(t,e){fconsole(t+": "+e),this.showMainError(e),i.loader.stop(this.getBlock(),"Error in returned JSON"),this.toggleSubmit(!0)}.bind(this),onFailure:function(t){fconsole(t),i.loader.stop(this.getBlock(),"Ajax failure"),this.toggleSubmit(!0)}.bind(this),onComplete:function(r,n){if(this.toggleSubmit(!0),"null"===typeOf(r))return i.loader.stop(this.getBlock(),"Error in returned JSON"),void fconsole("error in returned json",r,n);t(this.form.getElements("[data-role=fabrik_tab]")).removeClass("fabrikErrorGroup");var s=!1;if(void 0!==r.errors&&$H(r.errors).each(function(t,i){if(t.flatten().length>0&&(s=!0,this.formElements.has(i)))if(this.formElements[i].options.inRepeatGroup){for(e=0;e<t.length;e++)if(t[e].flatten().length>0){var o=i.replace(/(_\d+)$/,"_"+e);this._showElementError(t[e],o)}}else this._showElementError(t,i)}.bind(this)),this.updateMainError(),!1===s){var a=!1;""===this.options.rowid&&"apply"!==o.name&&(a=!0),i.loader.stop(this.getBlock());var l="null"!==typeOf(r.msg)&&void 0!==r.msg&&""!==r.msg?r.msg:Joomla.JText._("COM_FABRIK_FORM_SAVED");if(!0!==r.baseRedirect)if(a=r.reset_form,void 0!==r.url)if("popup"===r.redirect_how){var u=r.width?r.width:400,p=r.height?r.height:400,d=r.x_offset?r.x_offset:0,h=r.y_offset?r.y_offset:0,f=r.title?r.title:"";i.getWindow({id:"redirect",type:"redirect",contentURL:r.url,caller:this.getBlock(),height:p,width:u,offset_x:d,offset_y:h,title:f})}else"samepage"===r.redirect_how?window.open(r.url,"_self"):"newpage"===r.redirect_how&&window.open(r.url,"_blank");else r.suppressMsg||alert(l);else a=void 0!==r.reset_form?r.reset_form:a,r.suppressMsg||alert(l);i.fireEvent("fabrik.form.submitted",[this,r]),"apply"!==o.name&&(a&&this.clearForm(),i.Windows[this.options.fabrik_window_id]&&i.Windows[this.options.fabrik_window_id].close()),i.fireEvent("fabrik.form.submitted.end",[this,r])}else i.fireEvent("fabrik.form.submit.failed",[this,r]),i.loader.stop(this.getBlock(),Joomla.JText._("COM_FABRIK_VALIDATION_ERROR"))}.bind(this)}).send()}i.fireEvent("fabrik.form.submit.end",[this]),!1===this.result?(this.result=!0,e.stop(),this.updateMainError()):this.options.ajax?(e.stop(),i.fireEvent("fabrik.form.ajax.submit.end",[this])):"null"!==typeOf(o)?(new Element("input",{type:"hidden",name:o.name,value:o.value}).inject(this.form),this.form.submit()):e.stop()}.bind(this)),e.stop()},getFormData:function(t){(t="null"===typeOf(t)||t)&&this.formElements.each((function(t,e){t.onsubmit()})),this.getForm();var e=this.form.toQueryString(),i={};e=e.split("&");var o=$H({});e.each((function(t){var e=(t=t.split("="))[0];"[]"===(e=decodeURI(e)).substring(e.length-2)&&(e=e.substring(0,e.length-2),o.has(e)?o.set(e,o.get(e)+1):o.set(e,0),e=e+"["+o.get(e)+"]"),i[e]=t[1]}));this.formElements.getKeys();return this.formElements.each(function(t,e){if("fabrikfileupload"===t.plugin&&(i[e]=t.get("value")),"null"===typeOf(i[e])){var o=!1;$H(i).each(function(t,i){(i=(i=unescape(i)).replace(/\[(.*)\]/,""))===e&&(o=!0)}.bind(this)),o||(i[e]="")}}.bind(this)),i},getFormElementData:function(){var t={};return this.formElements.each(function(e,i){e.element&&(t[i]=e.getValue(),t[i+"_raw"]=t[i])}.bind(this)),t},watchGroupButtons:function(){var e=this;t(this.form).on("click",".deleteGroup",o(this.options.debounceDelay,!0,(function(t,i){if(t.preventDefault(),!e.addingOrDeletingGroup){e.addingOrDeletingGroup=!0;var o=t.target.getParent(".fabrikGroup"),r=t.target.getParent(".fabrikSubGroup");e.deleteGroup(t,o,r),e.addingOrDeletingGroup=!1}}))),t(this.form).on("click",".addGroup",o(this.options.debounceDelay,!0,(function(t,i){t.preventDefault(),e.addingOrDeletingGroup||(e.addingOrDeletingGroup=!0,e.duplicateGroup(t,!0),e.addingOrDeletingGroup=!1)}))),this.form&&this.form.addEvent("click:relay(.fabrikSubGroup)",function(t,e){var i=e.getElement(".fabrikGroupRepeater");i&&(e.addEvent("mouseenter",(function(t){i.fade(1)})),e.addEvent("mouseleave",(function(t){i.fade(.2)})))}.bind(this))},mockDuplicateGroup:function(t){var e=this.form.getElement("#group"+t+" .addGroup");if("null"!==typeOf(e)){var i=new Event.Mock(e,"click");return this.duplicateGroup(i,!1),!0}return!1},renumberRepeatGroup:function(e,i,o,r){var n=t(e).find(".fabrikinput");if(n){var s={},a={},l=n[0].id,u=this.formElements.get(l);if(u){var p=l.split("_").getLast();console.log("renumbering: "+p+" => "+o),u.update(o+1),this.formElements.each(function(t,e){t.groupid===i&&e.split("_").getLast()===p&&(s[e]=t.setName(o))}.bind(this)),$H(s).each(function(t,e){e!==t&&(a[t]=this.formElements[e],!0===r&&delete this.formElements[e])}.bind(this)),$H(a).each(function(t,e){this.formElements[e]=t}.bind(this))}}},renumberSortable:function(e){if("null"!==typeOf(this.options.group_repeat_sortable[e])&&this.options.group_repeat_sortable[e]){var i=this.options.group_repeat_order_element[e],o=this.form.getElement("#group"+e),r=t(o).find("tbody"),n=t(r).find(".fabrikRepeatGroup___"+i),s=1;n.each(function(e,i){var o=t(i).find(".fabrikinput");if(o){var r=o[0].id,n=this.formElements.get(r);n&&n.update(s)}s++}.bind(this))}},reorderSortable:function(e){if("null"!==typeOf(this.options.group_repeat_sortable[e])&&this.options.group_repeat_sortable[e]){var i=this.options.group_repeat_order_element[e],o={},r=this.form.getElement("#group"+e),n=t(r).find("tbody"),s=t(n).find(".fabrikRepeatGroup___"+i),a=0,l=!1,u=!1,p=!1,d=!1,h=!1,f=-1;if(s.each(function(e,i){if(!p){var o=t(i).find(".fabrikinput");if(o){var r=o[0].id;if(this.formElements.get(r)){var n=r.split("_").getLast().toInt();if(u)"down"===l&&n===d&&(h=a,a,p=!0);else{var s=n-f;2===s?(u=!0,l="down",d=a):s>2&&(u=!0,l="up",d=a,h=n,n,p=!0)}f=n,a++}}}}.bind(this)),"up"===l){c=s[h],this.renumberRepeatGroup(c,e,9999,!1);for(var m=h-1;m>=d;m--)c=s[m],this.renumberRepeatGroup(c,e,m,!1);c=s[h],this.renumberRepeatGroup(c,e,h,!0)}else{var c;c=s[h],this.renumberRepeatGroup(c,e,9999,!1);for(m=d;m<h;m++)c=s[m],this.renumberRepeatGroup(c,e,m,!1);c=s[h],this.renumberRepeatGroup(c,e,h,!0)}$H({}).each(function(t,e){e!==t&&(o[t]=this.formElements[e])}.bind(this)),$H(o).each(function(t,e){this.formElements[t]=e}.bind(this))}},setupSortable:function(){this.form&&Object.each(this.options.group_repeats,function(e,o){if(1===e.toInt()){if("null"!==typeOf(this.options.group_repeat_sortable[o])&&this.options.group_repeat_tablesort[o]){var r=this.form.getElement("#group"+o);if(r){var n=[];r.getElements("th.fabrikElementContainer").each((function(t,e){t.hasClass("fabrikHide")?n.push("fabrikHide"):n.push("")})),t("#group"+o+" table").tablesorter({theme:"blue",widthFixed:!0,widgets:["filter"],cssInfoBlock:"tablesorter-no-sort",ignoreCase:!0,widgetOptions:{filter_ignoreCase:!0,filter_matchType:{input:"match",select:"match"},filter_saveFilters:!0,filter_liveSearch:!0,filter_cellFilter:n}})}}"null"!==typeOf(this.options.group_repeat_sortable[o])&&this.options.group_repeat_sortable[o]&&(i.addEvent("fabrik.form.elements.added",function(t){this.renumberSortable(o)}.bind(this)),t("#group"+o+" table tbody").sortable({scroll:!0,scrollSensitivity:100,stop:function(t,e){var i=e.item[0].closest(".fabrikGroup").id.replace("group","");this.reorderSortable(i)}.bind(this)}))}}.bind(this))},duplicateGroupsToMin:function(){this.form&&(i.fireEvent("fabrik.form.group.duplicate.min",[this]),Object.each(this.options.group_repeats,function(e,i){if("null"!==typeOf(this.options.minRepeat[i])&&1===e.toInt()){var o,r,n,s,a,l,u,p=this.form.getElement("#fabrik_repeat_group_"+i+"_counter"),d=this.form.getElement("#fabrik_repeat_group_"+i+"_added").value;if("null"!==typeOf(p)){1===(o=r=p.value.toInt())&&(l=this.form.getElement("#"+this.options.group_pk_ids[i]+"_0"),"1"!==d&&"null"!==typeOf(l)&&""===l.value&&(r=0));var h,f=this.options.minRepeat[i].toInt(),m=this.options.maxRepeat[i].toInt(),c=this.form.getElement("#group"+i);if(0===f&&0===r)s=this.form.getElement("#group"+i+" .deleteGroup"),u="null"!==typeOf(s)&&new Event.Mock(s,"click"),h=c.getElement(".fabrikSubGroup"),this.deleteGroup(u,c,h);else if(o<f){if(n=this.form.getElement("#group"+i+" .addGroup"),"null"!==typeOf(n)){var g=new Event.Mock(n,"click");for(a=o;a<f;a++)this.duplicateGroup(g,!1)}}else if(m>0&&o>m)for(a=o;a>m;a--){var b=t(this.form.getElements("#group"+i+" .deleteGroup")).last()[0],E=t(b).find("[data-role=fabrik_delete_group]")[0];if(h=t(c.getElements(".fabrikSubGroup")).last()[0],"null"!==typeOf(E)){var v=new Event.Mock(E,"click");this.deleteGroup(v,c,h)}}this.setRepeatGroupIntro(c,i)}}}.bind(this)))},deleteGroup:function(e,o,r){if(i.fireEvent("fabrik.form.group.delete",[this,e,o]),!1!==this.result){e&&e.preventDefault();var n=0,s=t(e.target).find("[data-role=fabrik_delete_group]").addBack("[data-role=fabrik_delete_group]")[0];o.getElements(".deleteGroup").each(function(e,i){t(e).find("[data-role=fabrik_delete_group]")[0]===s&&(n=i)}.bind(this));var a=o.id.replace("group","");if(document.id("fabrik_repeat_group_"+a+"_counter").get("value").toInt()<=this.options.minRepeat[a]&&0!==this.options.minRepeat[a]){if(""!==this.options.minMaxErrMsg[a]){var l=this.options.minMaxErrMsg[a];l=(l=l.replace(/\{min\}/,this.options.minRepeat[a])).replace(/\{max\}/,this.options.maxRepeat[a]),alert(l)}}else if(delete this.duplicatedGroups.i,"0"!==document.id("fabrik_repeat_group_"+a+"_counter").value){var u=o.getElements(".fabrikSubGroup");if(this.subGroups.set(a,r.clone()),u.length<=1)this.hideLastGroup(a,r),this.formElements.each(function(t,e){t.groupid===a&&"null"!==typeOf(t.element)&&this.removeMustValidate(t)}.bind(this)),document.id("fabrik_repeat_group_"+a+"_added").value="0",i.fireEvent("fabrik.form.group.delete.end",[this,e,a,n]);else{var p=r.getPrevious();u.length>1&&r.dispose(),this.formElements.each(function(t,e){"null"!==typeOf(t.element)&&"null"===typeOf(document.id(t.element.id))&&(t.decloned(a),delete this.formElements[e])}.bind(this)),u=o.getElements(".fabrikSubGroup");var d={};if(this.formElements.each(function(t,e){t.groupid===a&&(d[e]=t.decreaseName(n))}.bind(this)),$H(d).each(function(t,e){e!==t&&(this.formElements[t]=this.formElements[e],delete this.formElements[e])}.bind(this)),i.fireEvent("fabrik.form.group.delete.end",[this,e,a,n]),p){var h=document.id(window).getScroll().y,f=p.getCoordinates();if(f.top<h){var m=f.top;this.winScroller.start(0,m)}}}document.id("fabrik_repeat_group_"+a+"_counter").value=document.id("fabrik_repeat_group_"+a+"_counter").get("value").toInt()-1,this.repeatGroupMarkers.set(a,this.repeatGroupMarkers.get(a)-1),this.renumberSortable(a),this.setRepeatGroupIntro(o,a)}}else this.result=!0},hideLastGroup:function(t,e){var i=this.options.noDataMsg[t];""===i&&(i=Joomla.JText._("COM_FABRIK_NO_REPEAT_GROUP_DATA"));var o=e.getElement(".fabrikSubGroupElements"),r=new Element("div",{class:"fabrikNotice alert"}).appendText(i);if("null"===typeOf(o)){var n=(o=e).getElement(".addGroup");if("null"!==typeOf(n)){var s=o.getParent("table").getElements('*[data-role="fabrik-group-repeaters"]').getLast();s||(s=o.getParent("table").getElements("thead th").getLast()),n.inject(s)}}o.setStyle("display","none"),r.inject(o,"after")},isFirstRepeatSubGroup:function(t){return 1===t.getElements(".fabrikSubGroup").length&&t.getElement(".fabrikNotice")},getSubGroupToClone:function(t){var e=document.id("group"+t).getElement(".fabrikSubGroup");e||(e=this.subGroups.get(t));var i=null,o=!1;return this.duplicatedGroups.has(t)&&(o=!0),o?i=e?e.cloneNode(!0):this.duplicatedGroups.get(t):(i=e.cloneNode(!0),this.duplicatedGroups.set(t,i)),i},repeatGetChecked:function(t){var e=[];return t.getElements(".fabrikinput").each((function(t){"radio"===t.type&&t.getProperty("checked")&&e.push(t)})),e},duplicateGroup:function(e,o){var r,n;if(o=void 0===o||o,i.fireEvent("fabrik.form.group.duplicate",[this,e]),!1!==this.result){e&&e.preventDefault();var s=e.target.getParent(".fabrikGroup").id.replace("group",""),a=s.toInt(),u=document.id("group"+s),p=this.repeatGroupMarkers.get(s),d=document.id("fabrik_repeat_group_"+s+"_counter").get("value").toInt();if(d>=this.options.maxRepeat[s]&&0!==this.options.maxRepeat[s]){if(""!==this.options.minMaxErrMsg[s]){var h=this.options.minMaxErrMsg[s];h=(h=h.replace(/\{min\}/,this.options.minRepeat[s])).replace(/\{max\}/,this.options.maxRepeat[s]),window.alert(h)}}else{if(document.id("fabrik_repeat_group_"+s+"_counter").value=d+1,this.isFirstRepeatSubGroup(u)){var f=u.getElements(".fabrikSubGroup"),m=f[0].getElement(".fabrikSubGroupElements");if("null"===typeOf(m))u.getElement(".fabrikNotice").dispose(),m=f[0],u.getElement(".addGroup").inject(m.getElement("div.fabrikGroupRepeater"),"top"),m.setStyle("display","");else f[0].getElement(".fabrikNotice").dispose(),f[0].getElement(".fabrikSubGroupElements").show();return this.repeatGroupMarkers.set(s,this.repeatGroupMarkers.get(s)+1),document.id("fabrik_repeat_group_"+s+"_added").value="1",this.formElements.each(function(t,e){t.groupid===s&&"null"!==typeOf(t.element)&&this.addMustValidate(t)}.bind(this)),void i.fireEvent("fabrik.form.group.duplicate.end",[this,e,s,p])}var c=this.getSubGroupToClone(s),g=this.repeatGetChecked(u),b=u.getElement("table.repeatGroupTable");b?(b.getElement("tbody")&&(b=b.getElement("tbody")),b.appendChild(c)):u.appendChild(c),g.each((function(t){t.setProperty("checked",!0)})),this.subelementCounter=0;var E=[],v=!1,k=c.getElements(".fabrikinput"),_=null;this.formElements.each(function(t){var e=!1;r=null;if(k.each(function(i){v=t.hasSubElements(),n=i.getParent(".fabrikSubElementContainer");var o=v&&n?n.id:i.id,s=t.getCloneName();if(o===s||o===s+"-auto-complete"){if(_=i,e=!0,v){if(r=i.getParent(".fabrikSubElementContainer"),document.id(o).getElement("input"))i.cloneEvents(document.id(o).getElement("input")),(a=r.getParent(".fabrikElementContainer").getElement("label"))&&a.setProperty("for",r.id)}else{i.cloneEvents(t.element);var a,l=Array.mfrom(t.element.id.split("_"));l.splice(l.length-1,1,p),i.id=l.join("_"),(a=i.getParent(".fabrikElementContainer").getElement("label"))&&a.setProperty("for",i.id)}"null"!==typeOf(i.name)&&(i.name=i.name.replace("[0]","["+p+"]"))}}.bind(this)),e){if(v&&"null"!==typeOf(r)){var i=Array.mfrom(t.options.element.split("_"));i.splice(i.length-1,1,p),r.id=i.join("_")}t.options.element;var o=t.unclonableProperties(),s=new CloneObject(t,!0,o);if(s.container=null,s.options.repeatCounter=p,v&&"null"!==typeOf(r)){s.element=document.id(r),s.cloneUpdateIds(r.id),s.options.element=r.id,s._getSubElements(),s.subElements.each((function(t){for(l=t.nextElementSibling;l;){if("LABEL"==l.nodeName){let t=l.htmlFor.split("_"),e=s.options.element.split("_");t[6]=e[6],l.htmlFor=t.join("_");break}l=l.nextElementSibling}}));let t=r.getElement("fieldset");t&&t.setAttribute("id",r.id)}else s.cloneUpdateIds(_.id);E.push(s)}}.bind(this)),E.each(function(t){t.cloned(p);var e=new RegExp(this.options.group_pk_ids[a]);!this.options.group_copy_element_values[a]||this.options.group_copy_element_values[a]&&t.element.name&&t.element.name.test(e)?t.reset():t.resetEvents()}.bind(this)),n&&(_.getParent(".fabrikElementContainer").getElement("label").htmlFor=n.id);var y={};if(y[s]=E,this.addElements(y),o){var w=t(window).height(),S=document.id(window).getScroll().y,G=c.getCoordinates();if(G.bottom>S+w){var O=G.bottom-w;this.winScroller.start(0,O)}}new Fx.Tween(c,{property:"opacity",duration:500}).set(0);c.fade(1),i.fireEvent("fabrik.form.group.duplicate.end",[this,e,s,p]),this.setRepeatGroupIntro(u,s),this.renumberSortable(s),this.repeatGroupMarkers.set(s,this.repeatGroupMarkers.get(s)+1),this.addedGroups.push("group"+s)}}else this.result=!0},setRepeatGroupIntro:function(t,e){var i=this.options.group_repeat_intro[e],o="";t.getElements('*[data-role="group-repeat-intro"]').each(function(t,e){o=i.replace("{i}",e+1),this.formElements.each((function(t){if(!t.options.inRepeatGroup){var e=new RegExp("{"+t.element.id+"}");o=o.replace(e,t.getValue())}})),t.set("html",o)}.bind(this))},update:function(t){if(i.fireEvent("fabrik.form.update",[this,t.data]),!1!==this.result){var e=arguments[1]||!1,o=t.data;if(this.getForm(),this.form){var r=this.form.getElement("input[name=rowid]");r&&o.rowid&&(r.value=o.rowid)}this.formElements.each(function(i,r){"null"===typeOf(o[r])&&"_ro"===r.substring(r.length-3,r.length)&&(r=r.substring(0,r.length-3)),"null"===typeOf(o[r])?t.id!==this.id||e||i.update(""):i.update(o[r])}.bind(this))}else this.result=!0},reset:function(){this.addedGroups.each((function(t){var e=document.id(t).findClassUp("fabrikGroup").id.replace("group","");document.id("fabrik_repeat_group_"+e+"_counter").value=document.id("fabrik_repeat_group_"+e+"_counter").get("value").toInt()-1,t.remove()})),this.addedGroups=[],i.fireEvent("fabrik.form.reset",[this]),!1!==this.result?this.formElements.each(function(t,e){t.reset()}.bind(this)):this.result=!0},showErrors:function(t){if(t.id===this.id){var e=new Hash(t.errors);e.getKeys().length>0&&("null"!==typeOf(this.form.getElement(".fabrikMainError"))&&(this.form.getElement(".fabrikMainError").set("html",this.options.error),this.form.getElement(".fabrikMainError").removeClass("fabrikHide")),e.each((function(t,e){if("null"!==typeOf(document.id(e+"_error")))for(var i=document.id(e+"_error"),o=(new Element("span"),0);o<t.length;o++)for(var r=0;r<t[o].length;r++)new Element("div").appendText(t[o][r]).inject(i);else fconsole(e+"_error not found (form show errors)")})))}},appendInfo:function(t){this.formElements.each(function(e,i){e.appendInfo&&e.appendInfo(t,i)}.bind(this))},clearForm:function(){this.getForm(),this.form&&(this.formElements.each(function(t,e){e===this.options.primaryKey&&(this.form.getElement("input[name=rowid]").value=""),t.update("")}.bind(this)),this.form.getElements(".fabrikError").empty(),this.form.getElements(".fabrikError").addClass("fabrikHide"))},clearErrors:function(){t(this.form).find(".fabrikError").removeClass("fabrikError").removeClass("error").removeClass("has-error"),this.hideTips()},hideTips:function(){this.elements.each((function(t){t.removeTipMsg()}))},scrollTips:function(){var e,o,r,n=this,s=t(n.form).closest(".fabrikWindow"),a=s.find(".itemContent"),l=function(){var t=s.data("origPosition");void 0===t&&(t=s.position(),s.data("origPosition",t)),r=s.position(),e=t.top-r.top+a.scrollTop(),o=t.left-r.left+a.scrollLeft(),n.elements.each((function(t){t.moveTip(e,o)}))};a.on("scroll",(function(){l()})),i.on("fabrik.window.resized",(function(t){s.length>0&&t===s[0]&&l()}))},stopEnterSubmitting:function(){var t=this.form.getElements("input.fabrikinput");t.each(function(e,i){e.addEvent("keypress",function(e){"enter"===e.key&&(e.stop(),t[i+1]&&t[i+1].focus(),i===t.length-1&&this._getButton("Submit").focus())}.bind(this))}.bind(this))},getSubGroupCounter:function(t){},addMustValidate:function(t){this.options.ajaxValidation&&this.options.toggleSubmit&&(this.mustValidateEls.set(t.element.id,t.options.mustValidate),t.options.mustValidate&&(this.options.mustValidate=!0,this.toggleSubmit(!1)))},removeMustValidate:function(t){this.options.ajaxValidation&&this.options.toggleSubmit&&(delete this.mustValidateEls[t.element.id],t.options.mustValidate&&(this.mustValidateEls.hasValue(!0)||this.toggleSubmit(!0)))},toggleSubmit:function(e){for(var o of["Submit","SubmitAndNew","SubmitAndDetails","apply"]){var r=this._getButton(o);"null"!==typeOf(r)&&(!0===e?(r.disabled="",r.setStyle("opacity",1),""!==this.options.toggleSubmitTip&&(t(this.form).find(".fabrikSubmitWrapper").tooltip("destroy"),this.toggleSubmitTipAdded=!1)):(r.disabled="disabled",r.setStyle("opacity",.5),""!==this.options.toggleSubmitTip&&(this.toggleSubmitTipAdded||(t(this.form).find(".fabrikSubmitWrapper").tooltip(),this.toggleSubmitTipAdded=!0))),i.fireEvent("fabrik.form.togglesubmit",[this,e]))}},addPlugins:function(e){var i=this;t.each(e,(function(t,e){e.form=i})),this.plugins=e}});return i.form=function(t,e,o){var n=new r(e,o);return i.addBlock(t,n),n},r}));