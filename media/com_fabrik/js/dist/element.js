/*! Fabrik */
define(["jquery"],function(jQuery){return window.FbElement=new Class({Implements:[Events,Options],options:{element:null,defaultVal:"",value:"",label:"",editable:!1,isJoin:!1,joinId:0,changeEvent:"change",hasAjaxValidation:!1},initialize:function(e,t){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)});var i=this;return this.setPlugin(""),t.element=e,this.strElement=e,this.loadEvents=[],this.events=$H({}),this.setOptions(t),this.options.advanced&&(e=this.getChangeEvent(),jQuery("#"+this.options.element).on("change",{changeEvent:e},function(e){document.id(this.id).fireEvent(e.data.changeEvent,new Event.Mock(document.id(this.id),e.data.changeEvent))})),Fabrik.on("fabrik.form.element.added",function(e,t,n){n===i&&i.addNewEvent(i.getFocusEvent(),function(){i.removeTipMsg()})}),this.setElement()},destroy:function(){},setPlugin:function(e){"null"!==typeOf(this.plugin)&&""!==this.plugin||(this.plugin=e)},getPlugin:function(){return this.plugin},setElement:function(){return!!document.id(this.options.element)&&(this.element=document.id(this.options.element),this.setorigId(),!0)},get:function(e){if("value"===e)return this.getValue()},getFormElementsKey:function(e){return this.baseElementId=e},attachedToForm:function(){this.setElement(),Fabrik.bootstrapped?(this.alertImage=new Element("i."+this.form.options.images.alert),this.successImage=new Element("i.icon-checkmark",{styles:{color:"green"}})):(this.alertImage=new Asset.image(this.form.options.images.alert),this.alertImage.setStyle("cursor","pointer"),this.successImage=new Asset.image(this.form.options.images.action_check)),jQuery(this.form.options.images.ajax_loader).data("isicon")?this.loadingImage=new Element("span").set("html",this.form.options.images.ajax_loader):this.loadingImage=new Asset.image(this.form.options.images.ajax_loader),this.form.addMustValidate(this)},fireEvents:function(e){this.hasSubElements()?this._getSubElements().each(function(t){Array.mfrom(e).each(function(e){t.fireEvent(e)}.bind(this))}.bind(this)):Array.mfrom(e).each(function(e){this.element&&this.element.fireEvent(e)}.bind(this))},getElement:function(){return"null"===typeOf(this.element)&&(this.element=document.id(this.options.element)),this.element},_getSubElements:function(){var e=this.getElement();return"null"!==typeOf(e)&&(this.subElements=e.getElements(".fabrikinput"),this.subElements)},hasSubElements:function(){return this._getSubElements(),("array"===typeOf(this.subElements)||"elements"===typeOf(this.subElements))&&0<this.subElements.length},unclonableProperties:function(){return["form"]},cloneUpdateIds:function(e){this.element=document.id(e),this.options.element=e},runLoadEvent:function(js,delay){delay=delay||0,"function"===typeOf(js)?js.delay(delay):0===delay?eval(js):function(){console.log("delayed calling runLoadEvent for "+delay),eval(js)}.bind(this).delay(delay)},removeCustomEvents:function(){},renewEvents:function(){this.events.each(function(e,t){this.element.removeEvents(t),e.each(function(e){this.addNewEventAux(t,e)}.bind(this))}.bind(this))},addNewEventAux:function(action,js){this.element.addEvent(action,function(e){"function"===typeOf(js)?js.delay(0,this,this):eval(js)}.bind(this))},addNewEvent:function(e,t){"load"===e?(this.loadEvents.push(t),this.runLoadEvent(t)):(this.element||(this.element=document.id(this.strElement)),this.element&&(Object.keys(this.events).contains(e)||(this.events[e]=[]),this.events[e].push(t),this.addNewEventAux(e,t)))},addEvent:function(e,t){this.addNewEvent(e,t)},validate:function(){},addAjaxValidationAux:function(){var e,t=this;this.element&&this.options.hasAjaxValidation&&((e=jQuery(this.element)).hasClass("fabrikSubElementContainer")?e.find(".fabrikinput").on(this.getChangeEvent(),function(e){t.form.doElementValidation(e,!0)}):e.on(this.getChangeEvent(),function(e){t.form.doElementValidation(e,!1)}))},addAjaxValidation:function(){this.element||(this.element=document.id(this.strElement)),this.element&&(this.options.hasAjaxValidation=!0,this.addAjaxValidationAux())},addNewOption:function(e,t){var n=document.id(this.options.element+"_additions").value,e={val:e,label:t},i=""!==n?JSON.parse(n):[];i.push(e);for(var s="[",a=0;a<i.length;a++)s+=JSON.stringify(i[a])+",";s=s.substring(0,s.length-1)+"]",document.id(this.options.element+"_additions").value=s},getLabel:function(){return this.options.label},setLabel:function(e){this.options.label=e;var t=this.getLabelElement();t&&(t[0].textContent=e)},update:function(e){this.getElement()&&(this.options.editable?this.element.value=e:this.element.innerHTML=e)},updateByLabel:function(e){this.update(e)},set:function(e){this.update(e)},getValue:function(){return!!this.element&&(this.options.editable?this.element:this.options).value},reset:function(){!0===this.options.editable&&this.update(this.options.defaultVal),this.resetEvents()},resetEvents:function(){this.loadEvents.each(function(e){this.runLoadEvent(e,100)}.bind(this))},clear:function(){this.update("")},onsubmit:function(e){e&&e(!0)},afterAjaxValidation:function(){},shouldAjaxValidate:function(){return!0},cloned:function(e){this.renewEvents(),this.resetEvents(),this.addAjaxValidationAux();var t=this.getChangeEvent();this.element.hasClass("chosen-done")&&(this.element.removeClass("chosen-done"),this.element.addClass("chosen-select"),this.element.getParent().getElement(".chosen-container").destroy(),jQuery("#"+this.element.id).chosen(),jQuery(this.element).addClass("chosen-done"),jQuery("#"+this.options.element).on("change",{changeEvent:t},function(e){document.id(this.id).fireEvent(e.data.changeEvent,new Event.Mock(e.data.changeEvent,document.id(this.id)))}))},decloned:function(e){this.form.removeMustValidate(this)},getContainer:function(){var e=0!==(e=jQuery(this.element).closest(".fabrikElementContainer")).length&&e[0];return"null"!==typeOf(this.element)&&e},getErrorElement:function(){return this.getContainer().getElements(".fabrikErrorMessage")},getLabelElement:function(){return this.getContainer().getElements(".fabrikLabel")},getValidationFx:function(){return this.validationFX||(this.validationFX=new Fx.Morph(this.getErrorElement()[0],{duration:500,wait:!0})),this.validationFX},tips:function(){var n=this;return jQuery(Fabrik.tips.elements).filter(function(e,t){if(t===n.getContainer()||t.getParent()===n.getContainer())return!0})},addTipMsg:function(e,t){t=t||"error";var n,i,s=this.tips();if(0!==s.length){void 0===(s=jQuery(s[0])).attr(t)&&(s.attr(t,e),n=this._tipContent(s,!1),(i=jQuery("<div>")).html(n.html()),(t=jQuery("<li>").addClass(t)).html(e),jQuery("<i>").addClass(this.form.options.images.alert).prependTo(t),0===i.find('li:contains("'+jQuery(e).text()+'")').length&&i.find("ul").append(t),e=unescape(i.html()),void 0===s.data("fabrik-tip-orig")&&s.data("fabrik-tip-orig",n.html()),this._recreateTip(s,e));try{s.data("popover").show()}catch(e){s.popover("show")}}},_recreateTip:function(t,n){try{t.data("content",n),t.data("popover").setContent(),t.data("popover").options.content=n}catch(e){t.attr("data-bs-content",n),t.popover("show")}},_tipContent:function(t,n){var i;try{t.data("popover").show(),i=t.data("popover").tip().find(".popover-content")}catch(e){i=void 0!==t.data("fabrik-tip-orig")&&n?jQuery("<div>").append(jQuery(t.data("fabrik-tip-orig"))):jQuery("<div>").append(jQuery(t.data("content")))}return i},removeTipMsg:function(){var e,t=this.tips();if(void 0!==(t=jQuery(t[0])).attr("error")){e=this._tipContent(t,!0),this._recreateTip(t,e.html()),t.removeAttr("error");try{t.data("popover").hide()}catch(e){t.popover("hide")}}},moveTip:function(e,t){var n,i,s=this.tips();0<s.length&&(i=(s=jQuery(s[0])).data("popover"))&&(i=i.$tip)&&(void 0===(n=i.data("origPos"))&&(n={top:parseInt(s.data("popover").$tip.css("top"),10)+e,left:parseInt(s.data("popover").$tip.css("left"),10)+t},i.data("origPos",n)),i.css({top:n.top-e,left:n.left-t}))},setErrorMessage:function(e,t){var n,i=["fabrikValidating","fabrikError","fabrikSuccess"],s=this.getContainer();if(!1===s)console.log("Notice: couldn not set error msg for "+e+" no container class found");else{i.each(function(e){t===e?s.addClass(e):s.removeClass(e)});var a=this.getErrorElement();switch(a.each(function(e){e.empty()}),t){case"fabrikError":Fabrik.loader.stop(this.element);var o=this.tips();if(Fabrik.bootstrapped&&0!==o.length?this.addTipMsg(e):(o=jQuery(e).text(),(r=new Element("a",{href:"#",class:"text-danger",text:o,events:{click:function(e){e.stop()}}})).prepend(this.alertImage),Fabrik.tips.attach(r)),a[0].adopt(r),s.removeClass("success").removeClass("info").addClass("error"),s.addClass("has-error").removeClass("has-success"),this.element.addClass("is-invalid").removeClass("is-valid"),1<a.length)for(n=1;n<a.length;n++)a[n].set("html",e);var r,o=this.getTabDiv();o&&(r=this.getTab(o))&&r.addClass("fabrikErrorGroup");break;case"fabrikSuccess":s.addClass("success").removeClass("info").removeClass("error"),s.addClass("has-success").removeClass("has-error"),this.element.addClass("is-valid").removeClass("is-invalid"),Fabrik.bootstrapped?(Fabrik.loader.stop(this.element),this.removeTipMsg()):(a[0].adopt(this.successImage),function(){a[0].addClass("fabrikHide"),s.removeClass("success")}.delay(700));break;case"fabrikValidating":s.removeClass("success").addClass("info").removeClass("error"),Fabrik.loader.start(this.element,e)}this.getErrorElement().removeClass("fabrikHide");var l=this.form,h=("fabrikError"!==t&&"fabrikSuccess"!==t||l.updateMainError(),this.getValidationFx());switch(t){case"fabrikValidating":case"fabrikError":h.start({opacity:1});break;case"fabrikSuccess":h.start({opacity:1}).chain(function(){s.hasClass("fabrikSuccess")&&(s.removeClass("fabrikSuccess"),this.start.delay(700,this,{opacity:0,onComplete:function(){s.addClass("success").removeClass("error"),l.updateMainError(),i.each(function(e){s.removeClass(e)})}}))})}}},setorigId:function(){var e;this.options.inRepeatGroup&&(e=this.options.element,this.origId=e.substring(0,e.length-1-this.options.repeatCounter.toString().length))},decreaseName:function(t){var e=this.getElement();return"null"!==typeOf(e)&&(this.hasSubElements()?this._getSubElements().each(function(e){e.name=this._decreaseName(e.name,t),e.id=this._decreaseId(e.id,t)}.bind(this)):"null"!==typeOf(this.element.name)&&(this.element.name=this._decreaseName(this.element.name,t)),"null"!==typeOf(this.element.id)&&(this.element.id=this._decreaseId(this.element.id,t)),this.options.repeatCounter>t&&this.options.repeatCounter--,this.element.id)},_decreaseId:function(e,t,n){var i=!1,e=(!1!==(n=n||!1)&&e.contains(n)&&(e=e.replace(n,""),i=!0),Array.mfrom(e.split("_"))),s=e.getLast();if("null"===typeOf(s.toInt()))return e.join("_");1<=s&&t<s&&s--,e.splice(e.length-1,1,s);t=e.join("_");return i&&(t+=n),this.options.element=t},_decreaseName:function(e,t,n){var i=!1,e=(!1!==(n=n||!1)&&e.contains(n)&&(e=e.replace(n,""),i=!0),e.split("[")),s=e[1].replace("]","").toInt(),t=(1<=s&&t<s&&s--,e[1]=s+="]",e.join("["));return i&&(t+=n),t},setContainerRepeatNum:function(e,t){var n=this.getContainer();jQuery(n).removeClass("fb_el_"+this.origId+"_"+e),jQuery(n).addClass("fb_el_"+this.origId+"_"+t)},setName:function(t){var e=this.getElement();return"null"!==typeOf(e)&&(this.hasSubElements()?this._getSubElements().each(function(e){e.name=this._setName(e.name,t),e.id=this._setId(e.id,t)}.bind(this)):"null"!==typeOf(this.element.name)&&(this.element.name=this._setName(this.element.name,t)),"null"!==typeOf(this.element.id)&&(this.element.id=this._setId(this.element.id,t)),this.setContainerRepeatNum(this.options.repeatCounter,t),this.options.repeatCounter=t,this.element.id)},_setId:function(e,t,n){var i=!1,s="",n=(!1!==(n=n||!1)&&(n=new RegExp(n),e.test(n))&&(s=e.match(n)[0],e=e.replace(n,""),i=!0),Array.mfrom(e.split("_"))),a=n.getLast();if("null"===typeOf(a.toInt()))return e+s;if(a.toInt()===t)return e+s;n.splice(n.length-1,1,a=t);e=n.join("_");return i&&(e+=s),this.options.element=e},_setName:function(e,t,n){var i=!1,s="",n=(!1!==(n=n||!1)&&(n=new RegExp(n),e.test(n))&&(s=e.match(n)[0],e=e.replace(n,""),i=!0),e.split("[")),a=n[1].replace("]","").toInt();if(a.toInt()===t)return e+s;a=t,n[1]=a+="]";e=n.join("[");return i&&(e+=s),e},getRepeatNum:function(){return!1!==this.options.inRepeatGroup&&this.element.id.split("_").getLast()},getBlurEvent:function(){return"select"===this.element.get("tag")?"change":"blur"},getFocusEvent:function(){return"select"===this.element.get("tag")?"click":"focus"},getChangeEvent:function(){return this.options.changeEvent},select:function(){},focus:function(){this.removeTipMsg()},hide:function(){var e=this.getContainer();e&&(jQuery(e).hide(),jQuery(e).addClass("fabrikHide"))},show:function(){var e=this.getContainer();e&&(jQuery(e).show(),jQuery(e).removeClass("fabrikHide"))},toggle:function(){var e=this.getContainer();e&&e.toggle()},getCloneName:function(){return this.options.element},doTab:function(e){!function(){this.redraw(),Fabrik.bootstrapped||this.options.tab_dt.removeEvent("click",function(e){this.doTab(e)}.bind(this))}.bind(this).delay(500)},getTab:function(e){return(e=Fabrik.bootstrapped?jQuery("[data-bs-target='#"+e.id+"']").closest(".nav-item"):e.getPrevious(".tabs"))||!1},getTabDiv:function(){var e=Fabrik.bootstrapped?".tab-pane":".current",e=this.element.getParent(e);return e||!1},watchTab:function(){var e,t=Fabrik.bootstrapped?".tab-pane":".current",t=this.element.getParent(t);t&&(Fabrik.bootstrapped?(e=document.getElement("[data-bs-target='#"+t.id+"']").getParent("ul.nav")).addEvent("click:relay(a)",function(e,t){this.doTab(e)}.bind(this)):(e=t.getPrevious(".tabs"))&&(this.options.tab_dd=this.element.getParent(".fabrikGroup"),"none"===this.options.tab_dd.style.getPropertyValue("display"))&&(this.options.tab_dt=e.getElementById("group"+this.groupid+"_tab"),this.options.tab_dt)&&this.options.tab_dt.addEvent("click",function(e){this.doTab(e)}.bind(this)))},updateUsingRaw:function(){return!1}}),window.FbElement});
//# sourceMappingURL=element.js.map