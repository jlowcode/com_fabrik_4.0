/*! Fabrik */
define(["jquery","fab/element"],function(r,e){return window.FbFileElement=new Class({Extends:e,ajaxFolder:function(){var e,i=this;this.folderlist=[],null!==this.element&&(e=r(this.element.getParent(".fabrikElement")),this.breadcrumbs=e.find(".breadcrumbs"),this.folderdiv=e.find(".folderselect"),r(this.folderdiv).slideUp({duration:0}),this.hiddenField=e.find(".folderpath")[0],e.find(".toggle").on("click",function(e){e.preventDefault(),r(i.folderdiv).slideToggle()}),this.watchAjaxFolderLinks())},watchAjaxFolderLinks:function(){var i=this;this.folderdiv.find("a").on("click",function(e){e.preventDefault(),i.browseFolders(r(this))}),this.breadcrumbs.find("a").on("click",function(e){e.preventDefault(),i.useBreadcrumbs(r(this))})},browseFolders:function(e){this.folderlist.push(e.text());var i=this.options.dir+this.folderlist.join(this.options.ds);this.addCrumb(e.text()),this.doAjaxBrowse(i)},useBreadcrumbs:function(e){var i,t,s,d=this,e=e[0].className;if(this.folderlist=[],""!==e)for(i=parseInt(e.replace("crumb",""),10),t=1;t<=i;t++)s=r(this.breadcrumbs.find("a")[t]),d.folderlist.push(r(s).html());e=[this.breadcrumbs.find("a")[0].clone(),this.breadcrumbs.find("span")[0].clone()],delete this.breadcrumbs.find("a")[0],delete this.breadcrumbs.find("span")[0],this.breadcrumbs.empty(),this.breadcrumbs.append(e),this.folderlist.each(function(e){d.addCrumb(e)}),e=this.options.dir+this.folderlist.join(this.options.ds),this.doAjaxBrowse(e)},doAjaxBrowse:function(e){var i=this;r.ajax({url:"",data:{dir:e,option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"fileupload",method:"ajax_getFolders",element_id:this.options.id}}).done(function(e){e=JSON.parse(e),i.folderdiv.empty(),e.each(function(e){e=r('<li class="fileupload_folder"><a href="#">'+e+"</a>");i.folderdiv.append(e)}),0===e.length?r(i.folderdiv).slideUp({duration:0}):r(i.folderdiv).slideUp(),i.watchAjaxFolderLinks(),r(i.hiddenField).val("/"+i.folderlist.join("/")+"/"),i.fireEvent("onBrowse")})},addCrumb:function(e){this.breadcrumbs.append(r('<a href="#" class="crumb'+this.folderlist.length+'">'+e+"</a>"),r("<span> / </span>"))}}),window.FbFileElement});
//# sourceMappingURL=fileelement.js.map